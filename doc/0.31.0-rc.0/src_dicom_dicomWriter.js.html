<!DOCTYPE html><html lang="en" style="font-size:16px"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Source: src/dicom/dicomWriter.js</title><!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]--><script src="scripts/third-party/hljs.js" defer="defer"></script><script src="scripts/third-party/hljs-line-num.js" defer="defer"></script><script src="scripts/third-party/popper.js" defer="defer"></script><script src="scripts/third-party/tippy.js" defer="defer"></script><script src="scripts/third-party/tocbot.min.js"></script><script>var baseURL="/",locationPathname="",baseURL=(locationPathname=document.location.pathname).substr(0,locationPathname.lastIndexOf("/")+1)</script><link rel="stylesheet" href="styles/clean-jsdoc-theme.min.css"><style>ul{list-style-type:disc!important}ul ul{list-style-type:circle!important}</style><svg aria-hidden="true" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" style="display:none"><defs><symbol id="copy-icon" viewbox="0 0 488.3 488.3"><g><path d="M314.25,85.4h-227c-21.3,0-38.6,17.3-38.6,38.6v325.7c0,21.3,17.3,38.6,38.6,38.6h227c21.3,0,38.6-17.3,38.6-38.6V124    C352.75,102.7,335.45,85.4,314.25,85.4z M325.75,449.6c0,6.4-5.2,11.6-11.6,11.6h-227c-6.4,0-11.6-5.2-11.6-11.6V124    c0-6.4,5.2-11.6,11.6-11.6h227c6.4,0,11.6,5.2,11.6,11.6V449.6z"/><path d="M401.05,0h-227c-21.3,0-38.6,17.3-38.6,38.6c0,7.5,6,13.5,13.5,13.5s13.5-6,13.5-13.5c0-6.4,5.2-11.6,11.6-11.6h227    c6.4,0,11.6,5.2,11.6,11.6v325.7c0,6.4-5.2,11.6-11.6,11.6c-7.5,0-13.5,6-13.5,13.5s6,13.5,13.5,13.5c21.3,0,38.6-17.3,38.6-38.6    V38.6C439.65,17.3,422.35,0,401.05,0z"/></g></symbol><symbol id="search-icon" viewBox="0 0 512 512"><g><g><path d="M225.474,0C101.151,0,0,101.151,0,225.474c0,124.33,101.151,225.474,225.474,225.474    c124.33,0,225.474-101.144,225.474-225.474C450.948,101.151,349.804,0,225.474,0z M225.474,409.323    c-101.373,0-183.848-82.475-183.848-183.848S124.101,41.626,225.474,41.626s183.848,82.475,183.848,183.848    S326.847,409.323,225.474,409.323z"/></g></g><g><g><path d="M505.902,476.472L386.574,357.144c-8.131-8.131-21.299-8.131-29.43,0c-8.131,8.124-8.131,21.306,0,29.43l119.328,119.328    c4.065,4.065,9.387,6.098,14.715,6.098c5.321,0,10.649-2.033,14.715-6.098C514.033,497.778,514.033,484.596,505.902,476.472z"/></g></g></symbol><symbol id="font-size-icon" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0z"/><path d="M11.246 15H4.754l-2 5H.6L7 4h2l6.4 16h-2.154l-2-5zm-.8-2L8 6.885 5.554 13h4.892zM21 12.535V12h2v8h-2v-.535a4 4 0 1 1 0-6.93zM19 18a2 2 0 1 0 0-4 2 2 0 0 0 0 4z"/></symbol><symbol id="add-icon" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0z"/><path d="M11 11V5h2v6h6v2h-6v6h-2v-6H5v-2z"/></symbol><symbol id="minus-icon" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0z"/><path d="M5 11h14v2H5z"/></symbol><symbol id="dark-theme-icon" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0z"/><path d="M10 7a7 7 0 0 0 12 4.9v.1c0 5.523-4.477 10-10 10S2 17.523 2 12 6.477 2 12 2h.1A6.979 6.979 0 0 0 10 7zm-6 5a8 8 0 0 0 15.062 3.762A9 9 0 0 1 8.238 4.938 7.999 7.999 0 0 0 4 12z"/></symbol><symbol id="light-theme-icon" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0z"/><path d="M12 18a6 6 0 1 1 0-12 6 6 0 0 1 0 12zm0-2a4 4 0 1 0 0-8 4 4 0 0 0 0 8zM11 1h2v3h-2V1zm0 19h2v3h-2v-3zM3.515 4.929l1.414-1.414L7.05 5.636 5.636 7.05 3.515 4.93zM16.95 18.364l1.414-1.414 2.121 2.121-1.414 1.414-2.121-2.121zm2.121-14.85l1.414 1.415-2.121 2.121-1.414-1.414 2.121-2.121zM5.636 16.95l1.414 1.414-2.121 2.121-1.414-1.414 2.121-2.121zM23 11v2h-3v-2h3zM4 11v2H1v-2h3z"/></symbol><symbol id="reset-icon" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0z"/><path d="M18.537 19.567A9.961 9.961 0 0 1 12 22C6.477 22 2 17.523 2 12S6.477 2 12 2s10 4.477 10 10c0 2.136-.67 4.116-1.81 5.74L17 12h3a8 8 0 1 0-2.46 5.772l.997 1.795z"/></symbol><symbol id="down-icon" viewBox="0 0 16 16"><path fill-rule="evenodd" clip-rule="evenodd" d="M12.7803 6.21967C13.0732 6.51256 13.0732 6.98744 12.7803 7.28033L8.53033 11.5303C8.23744 11.8232 7.76256 11.8232 7.46967 11.5303L3.21967 7.28033C2.92678 6.98744 2.92678 6.51256 3.21967 6.21967C3.51256 5.92678 3.98744 5.92678 4.28033 6.21967L8 9.93934L11.7197 6.21967C12.0126 5.92678 12.4874 5.92678 12.7803 6.21967Z"></path></symbol><symbol id="codepen-icon" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0z"/><path d="M16.5 13.202L13 15.535v3.596L19.197 15 16.5 13.202zM14.697 12L12 10.202 9.303 12 12 13.798 14.697 12zM20 10.869L18.303 12 20 13.131V10.87zM19.197 9L13 4.869v3.596l3.5 2.333L19.197 9zM7.5 10.798L11 8.465V4.869L4.803 9 7.5 10.798zM4.803 15L11 19.131v-3.596l-3.5-2.333L4.803 15zM4 13.131L5.697 12 4 10.869v2.262zM2 9a1 1 0 0 1 .445-.832l9-6a1 1 0 0 1 1.11 0l9 6A1 1 0 0 1 22 9v6a1 1 0 0 1-.445.832l-9 6a1 1 0 0 1-1.11 0l-9-6A1 1 0 0 1 2 15V9z"/></symbol><symbol id="close-icon" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0z"/><path d="M12 10.586l4.95-4.95 1.414 1.414-4.95 4.95 4.95 4.95-1.414 1.414-4.95-4.95-4.95 4.95-1.414-1.414 4.95-4.95-4.95-4.95L7.05 5.636z"/></symbol><symbol id="menu-icon" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0z"/><path d="M3 4h18v2H3V4zm0 7h18v2H3v-2zm0 7h18v2H3v-2z"/></symbol></defs></svg></head><body class="dark" data-theme="dark"><div class="sidebar-container"><div class="sidebar" id="sidebar"><a href="/" class="sidebar-title sidebar-title-anchor">DWV doc</a><div class="sidebar-items-container"><div class="sidebar-section-title with-arrow" data-isopen="false" id="gMKB9jkVlMTZFjQFvZ078"><div>Tutorials</div><svg><use xlink:href="#down-icon"></use></svg></div><div class="sidebar-section-children-container"><div class="sidebar-section-children"><a href="tutorial-architecture.html">architecture</a></div><div class="sidebar-section-children"><a href="tutorial-conformance.html">conformance</a></div><div class="sidebar-section-children"><a href="tutorial-developing.html">developing</a></div><div class="sidebar-section-children"><a href="tutorial-errors.html">errors</a></div><div class="sidebar-section-children"><a href="tutorial-examples.html">examples</a></div><div class="sidebar-section-children"><a href="tutorial-integrations.html">integrations</a></div><div class="sidebar-section-children"><a href="tutorial-module.html">module</a></div><div class="sidebar-section-children"><a href="tutorial-standards.html">standards</a></div><div class="sidebar-section-children"><a href="tutorial-user-stories.html">user-stories</a></div></div><div class="sidebar-section-title with-arrow" data-isopen="false" id="XMnq3KWHu5us0GuiC_tcf"><div>Namespaces</div><svg><use xlink:href="#down-icon"></use></svg></div><div class="sidebar-section-children-container"><div class="sidebar-section-children"><a href="dwv.html">dwv</a></div><div class="sidebar-section-children"><a href="dwv.ctrl.html">ctrl</a></div><div class="sidebar-section-children"><a href="dwv.dicom.html">dicom</a></div><div class="sidebar-section-children"><a href="dwv.env.html">env</a></div><div class="sidebar-section-children"><a href="dwv.gui.html">gui</a></div><div class="sidebar-section-children"><a href="dwv.image.html">image</a></div><div class="sidebar-section-children"><a href="dwv.image.filter.html">filter</a></div><div class="sidebar-section-children"><a href="dwv.image.lut.html">lut</a></div><div class="sidebar-section-children"><a href="dwv.io.html">io</a></div><div class="sidebar-section-children"><a href="dwv.math.html">math</a></div><div class="sidebar-section-children"><a href="dwv.test.html">test</a></div><div class="sidebar-section-children"><a href="dwv.tool.html">tool</a></div><div class="sidebar-section-children"><a href="dwv.tool.draw_.html">draw</a></div><div class="sidebar-section-children"><a href="dwv.tool.filter_.html">filter</a></div><div class="sidebar-section-children"><a href="dwv.utils.html">utils</a></div><div class="sidebar-section-children"><a href="dwv.utils.logger.html">logger</a></div><div class="sidebar-section-children"><a href="dwv.utils.logger.console.html">console</a></div></div><div class="sidebar-section-title with-arrow" data-isopen="false" id="XB1UeGrgiPqtbCK7EE0_T"><div>Events</div><svg><use xlink:href="#down-icon"></use></svg></div><div class="sidebar-section-children-container"><div class="sidebar-section-children"><a href="dwv.App.html#event:keydown">keydown</a></div><div class="sidebar-section-children"><a href="dwv.App.html#event:load">load</a></div><div class="sidebar-section-children"><a href="dwv.App.html#event:loadabort">loadabort</a></div><div class="sidebar-section-children"><a href="dwv.App.html#event:loadend">loadend</a></div><div class="sidebar-section-children"><a href="dwv.App.html#event:loaderror">loaderror</a></div><div class="sidebar-section-children"><a href="dwv.App.html#event:loaditem">loaditem</a></div><div class="sidebar-section-children"><a href="dwv.App.html#event:loadprogress">loadprogress</a></div><div class="sidebar-section-children"><a href="dwv.App.html#event:loadstart">loadstart</a></div><div class="sidebar-section-children"><a href="dwv.App.html#event:opacitychange">opacitychange</a></div><div class="sidebar-section-children"><a href="dwv.App.html#event:renderend">renderend</a></div><div class="sidebar-section-children"><a href="dwv.App.html#event:renderstart">renderstart</a></div><div class="sidebar-section-children"><a href="dwv.ctrl.LayerGroup.html#event:offsetchange">offsetchange</a></div><div class="sidebar-section-children"><a href="dwv.ctrl.LayerGroup.html#event:zoomchange">zoomchange</a></div><div class="sidebar-section-children"><a href="dwv.image.DeleteSegmentCommand.html#event:masksegmentdelete">masksegmentdelete</a></div><div class="sidebar-section-children"><a href="dwv.image.DeleteSegmentCommand.html#event:masksegmentredraw">masksegmentredraw</a></div><div class="sidebar-section-children"><a href="dwv.image.Image.html#event:imagechange">imagechange</a></div><div class="sidebar-section-children"><a href="dwv.image.View.html#event:alphafuncchange">alphafuncchange</a></div><div class="sidebar-section-children"><a href="dwv.image.View.html#event:colourchange">colourchange</a></div><div class="sidebar-section-children"><a href="dwv.image.View.html#event:positionchange">positionchange</a></div><div class="sidebar-section-children"><a href="dwv.image.View.html#event:wlchange">wlchange</a></div><div class="sidebar-section-children"><a href="dwv.image.View.html#event:wlpresetadd">wlpresetadd</a></div><div class="sidebar-section-children"><a href="dwv.tool.ChangeGroupCommand.html#event:drawchange">drawchange</a></div><div class="sidebar-section-children"><a href="dwv.tool.DeleteGroupCommand.html#event:drawdelete">drawdelete</a></div><div class="sidebar-section-children"><a href="dwv.tool.DrawGroupCommand.html#event:drawcreate">drawcreate</a></div><div class="sidebar-section-children"><a href="dwv.tool.MoveGroupCommand.html#event:drawmove">drawmove</a></div><div class="sidebar-section-children"><a href="dwv.tool.RunFilterCommand.html#event:filterrun">filterrun</a></div><div class="sidebar-section-children"><a href="dwv.tool.RunFilterCommand.html#event:filterundo">filterundo</a></div><div class="sidebar-section-children"><a href="dwv.tool.UndoStack.html#event:redo">redo</a></div><div class="sidebar-section-children"><a href="dwv.tool.UndoStack.html#event:undo">undo</a></div><div class="sidebar-section-children"><a href="dwv.tool.UndoStack.html#event:undoadd">undoadd</a></div></div><div class="sidebar-section-title with-arrow" data-isopen="false" id="nYE11oplZw5EksiXPDNlq"><div>Classes</div><svg><use xlink:href="#down-icon"></use></svg></div><div class="sidebar-section-children-container"><div class="sidebar-section-children"><a href="FilePixGenerator.html">FilePixGenerator</a></div><div class="sidebar-section-children"><a href="GradSquarePixGenerator.html">GradSquarePixGenerator</a></div><div class="sidebar-section-children"><a href="MPRPixGenerator.html">MPRPixGenerator</a></div><div class="sidebar-section-children"><a href="dcmb.utils.ListenerHandler.html">ListenerHandler</a></div><div class="sidebar-section-children"><a href="dwv.App.html">App</a></div><div class="sidebar-section-children"><a href="dwv.ModernizrInit-ModernizrProto.html">ModernizrProto</a></div><div class="sidebar-section-children"><a href="dwv.ctrl.DrawController.html">DrawController</a></div><div class="sidebar-section-children"><a href="dwv.ctrl.LoadController.html">LoadController</a></div><div class="sidebar-section-children"><a href="dwv.ctrl.ToolboxController.html">ToolboxController</a></div><div class="sidebar-section-children"><a href="dwv.ctrl.ViewController.html">ViewController</a></div><div class="sidebar-section-children"><a href="dwv.dicom.DataReader.html">DataReader</a></div><div class="sidebar-section-children"><a href="dwv.dicom.DataWriter.html">DataWriter</a></div><div class="sidebar-section-children"><a href="dwv.dicom.DicomElementsWrapper.html">DicomElementsWrapper</a></div><div class="sidebar-section-children"><a href="dwv.dicom.DicomParser.html">DicomParser</a></div><div class="sidebar-section-children"><a href="dwv.dicom.DicomWriter.html">DicomWriter</a></div><div class="sidebar-section-children"><a href="dwv.dicom.Tag.html">Tag</a></div><div class="sidebar-section-children"><a href="dwv.gui.DrawLayer.html">DrawLayer</a></div><div class="sidebar-section-children"><a href="dwv.gui.LayerGroup.html">LayerGroup</a></div><div class="sidebar-section-children"><a href="dwv.gui.Stage.html">Stage</a></div><div class="sidebar-section-children"><a href="dwv.gui.Style.html">Style</a></div><div class="sidebar-section-children"><a href="dwv.gui.ViewLayer.html">ViewLayer</a></div><div class="sidebar-section-children"><a href="dwv.image.AsynchPixelBufferDecoder.html">AsynchPixelBufferDecoder</a></div><div class="sidebar-section-children"><a href="dwv.image.DeleteSegmentCommand.html">DeleteSegmentCommand</a></div><div class="sidebar-section-children"><a href="dwv.image.DicomBufferToView.html">DicomBufferToView</a></div><div class="sidebar-section-children"><a href="dwv.image.Geometry.html">Geometry</a></div><div class="sidebar-section-children"><a href="dwv.image.Image.html">Image</a></div><div class="sidebar-section-children"><a href="dwv.image.ImageFactory.html">ImageFactory</a></div><div class="sidebar-section-children"><a href="dwv.image.MaskFactory.html">MaskFactory</a></div><div class="sidebar-section-children"><a href="dwv.image.MaskSegmentHelper.html">MaskSegmentHelper</a></div><div class="sidebar-section-children"><a href="dwv.image.PixelBufferDecoder.html">PixelBufferDecoder</a></div><div class="sidebar-section-children"><a href="dwv.image.PlaneHelper.html">PlaneHelper</a></div><div class="sidebar-section-children"><a href="dwv.image.RescaleLut.html">RescaleLut</a></div><div class="sidebar-section-children"><a href="dwv.image.RescaleSlopeAndIntercept.html">RescaleSlopeAndIntercept</a></div><div class="sidebar-section-children"><a href="dwv.image.Size.html">Size</a></div><div class="sidebar-section-children"><a href="dwv.image.Spacing.html">Spacing</a></div><div class="sidebar-section-children"><a href="dwv.image.SynchPixelBufferDecoder.html">SynchPixelBufferDecoder</a></div><div class="sidebar-section-children"><a href="dwv.image.View.html">View</a></div><div class="sidebar-section-children"><a href="dwv.image.ViewFactory.html">ViewFactory</a></div><div class="sidebar-section-children"><a href="dwv.image.WindowLevel.html">WindowLevel</a></div><div class="sidebar-section-children"><a href="dwv.image.WindowLut.html">WindowLut</a></div><div class="sidebar-section-children"><a href="dwv.image.filter.Sharpen.html">Sharpen</a></div><div class="sidebar-section-children"><a href="dwv.image.filter.Sobel.html">Sobel</a></div><div class="sidebar-section-children"><a href="dwv.image.filter.Threshold.html">Threshold</a></div><div class="sidebar-section-children"><a href="dwv.io.DicomDataLoader.html">DicomDataLoader</a></div><div class="sidebar-section-children"><a href="dwv.io.FilesLoader.html">FilesLoader</a></div><div class="sidebar-section-children"><a href="dwv.io.JSONTextLoader.html">JSONTextLoader</a></div><div class="sidebar-section-children"><a href="dwv.io.MemoryLoader.html">MemoryLoader</a></div><div class="sidebar-section-children"><a href="dwv.io.MultipartLoader.html">MultipartLoader</a></div><div class="sidebar-section-children"><a href="dwv.io.RawImageLoader.html">RawImageLoader</a></div><div class="sidebar-section-children"><a href="dwv.io.RawVideoLoader.html">RawVideoLoader</a></div><div class="sidebar-section-children"><a href="dwv.io.State.html">State</a></div><div class="sidebar-section-children"><a href="dwv.io.UrlsLoader.html">UrlsLoader</a></div><div class="sidebar-section-children"><a href="dwv.io.ZipLoader.html">ZipLoader</a></div><div class="sidebar-section-children"><a href="dwv.math.BucketQueue.html">BucketQueue</a></div><div class="sidebar-section-children"><a href="dwv.math.Circle.html">Circle</a></div><div class="sidebar-section-children"><a href="dwv.math.Ellipse.html">Ellipse</a></div><div class="sidebar-section-children"><a href="dwv.math.Index.html">Index</a></div><div class="sidebar-section-children"><a href="dwv.math.Line.html">Line</a></div><div class="sidebar-section-children"><a href="dwv.math.Matrix33.html">Matrix33</a></div><div class="sidebar-section-children"><a href="dwv.math.Path.html">Path</a></div><div class="sidebar-section-children"><a href="dwv.math.Point.html">Point</a></div><div class="sidebar-section-children"><a href="dwv.math.Point2D.html">Point2D</a></div><div class="sidebar-section-children"><a href="dwv.math.Point3D.html">Point3D</a></div><div class="sidebar-section-children"><a href="dwv.math.ROI.html">ROI</a></div><div class="sidebar-section-children"><a href="dwv.math.Rectangle.html">Rectangle</a></div><div class="sidebar-section-children"><a href="dwv.math.Scissors.html">Scissors</a></div><div class="sidebar-section-children"><a href="dwv.math.SimpleStats.html">SimpleStats</a></div><div class="sidebar-section-children"><a href="dwv.math.Vector3D.html">Vector3D</a></div><div class="sidebar-section-children"><a href="dwv.tool.ChangeGroupCommand.html">ChangeGroupCommand</a></div><div class="sidebar-section-children"><a href="dwv.tool.DeleteGroupCommand.html">DeleteGroupCommand</a></div><div class="sidebar-section-children"><a href="dwv.tool.Draw.html">Draw</a></div><div class="sidebar-section-children"><a href="dwv.tool.DrawGroupCommand.html">DrawGroupCommand</a></div><div class="sidebar-section-children"><a href="dwv.tool.Filter.html">Filter</a></div><div class="sidebar-section-children"><a href="dwv.tool.Floodfill.html">Floodfill</a></div><div class="sidebar-section-children"><a href="dwv.tool.Livewire.html">Livewire</a></div><div class="sidebar-section-children"><a href="dwv.tool.MoveGroupCommand.html">MoveGroupCommand</a></div><div class="sidebar-section-children"><a href="dwv.tool.Opacity.html">Opacity</a></div><div class="sidebar-section-children"><a href="dwv.tool.RunFilterCommand.html">RunFilterCommand</a></div><div class="sidebar-section-children"><a href="dwv.tool.Scroll.html">Scroll</a></div><div class="sidebar-section-children"><a href="dwv.tool.ScrollWheel.html">ScrollWheel</a></div><div class="sidebar-section-children"><a href="dwv.tool.ShapeEditor.html">ShapeEditor</a></div><div class="sidebar-section-children"><a href="dwv.tool.UndoStack.html">UndoStack</a></div><div class="sidebar-section-children"><a href="dwv.tool.WindowLevel.html">WindowLevel</a></div><div class="sidebar-section-children"><a href="dwv.tool.ZoomAndPan.html">ZoomAndPan</a></div><div class="sidebar-section-children"><a href="dwv.tool.draw.ArrowFactory.html">ArrowFactory</a></div><div class="sidebar-section-children"><a href="dwv.tool.draw.CircleFactory.html">CircleFactory</a></div><div class="sidebar-section-children"><a href="dwv.tool.draw.EllipseFactory.html">EllipseFactory</a></div><div class="sidebar-section-children"><a href="dwv.tool.draw.FreeHandFactory.html">FreeHandFactory</a></div><div class="sidebar-section-children"><a href="dwv.tool.draw.ProtractorFactory.html">ProtractorFactory</a></div><div class="sidebar-section-children"><a href="dwv.tool.draw.RectangleFactory.html">RectangleFactory</a></div><div class="sidebar-section-children"><a href="dwv.tool.draw.RoiFactory.html">RoiFactory</a></div><div class="sidebar-section-children"><a href="dwv.tool.draw.RulerFactory.html">RulerFactory</a></div><div class="sidebar-section-children"><a href="dwv.tool.filter.Sharpen.html">Sharpen</a></div><div class="sidebar-section-children"><a href="dwv.tool.filter.Sobel.html">Sobel</a></div><div class="sidebar-section-children"><a href="dwv.tool.filter.Threshold.html">Threshold</a></div><div class="sidebar-section-children"><a href="dwv.utils.ListenerHandler.html">ListenerHandler</a></div><div class="sidebar-section-children"><a href="dwv.utils.ThreadPool.html">ThreadPool</a></div><div class="sidebar-section-children"><a href="dwv.utils.WorkerTask.html">WorkerTask</a></div><div class="sidebar-section-children"><a href="dwv.utils.WorkerThread.html">WorkerThread</a></div></div><div class="sidebar-section-title with-arrow" data-isopen="false" id="gCSpF9Amf-JCfSNz7Y70c"><div>Externals</div><svg><use xlink:href="#down-icon"></use></svg></div><div class="sidebar-section-children-container"><div class="sidebar-section-children"><a href="external-FileReader.html">FileReader</a></div><div class="sidebar-section-children"><a href="external-JSZip.html">JSZip</a></div><div class="sidebar-section-children"><a href="external-JpegImage.html">JpegImage</a></div><div class="sidebar-section-children"><a href="external-JpxImage.html">JpxImage</a></div><div class="sidebar-section-children"><a href="external-JpxImage.html">JpxImage</a></div><div class="sidebar-section-children"><a href="external-Konva.html">Konva</a></div><div class="sidebar-section-children"><a href="external-Konva.html">Konva</a></div><div class="sidebar-section-children"><a href="external-Konva.html">Konva</a></div><div class="sidebar-section-children"><a href="external-Konva.html">Konva</a></div><div class="sidebar-section-children"><a href="external-Konva.html">Konva</a></div><div class="sidebar-section-children"><a href="external-Konva.html">Konva</a></div><div class="sidebar-section-children"><a href="external-Konva.html">Konva</a></div><div class="sidebar-section-children"><a href="external-Konva.html">Konva</a></div><div class="sidebar-section-children"><a href="external-Konva.html">Konva</a></div><div class="sidebar-section-children"><a href="external-Konva.html">Konva</a></div><div class="sidebar-section-children"><a href="external-Konva.html">Konva</a></div><div class="sidebar-section-children"><a href="external-Konva.html">Konva</a></div><div class="sidebar-section-children"><a href="external-Konva.html">Konva</a></div><div class="sidebar-section-children"><a href="external-MagicWand.html">MagicWand</a></div><div class="sidebar-section-children"><a href="external-TextDecoder.html">TextDecoder</a></div><div class="sidebar-section-children"><a href="external-TextEncoder.html">TextEncoder</a></div><div class="sidebar-section-children"><a href="external-Worker.html">Worker</a></div><div class="sidebar-section-children"><a href="external-XMLHttpRequest.html">XMLHttpRequest</a></div><div class="sidebar-section-children"><a href="external-XMLHttpRequest.html">XMLHttpRequest</a></div><div class="sidebar-section-children"><a href="external-i18next.html">i18next</a></div><div class="sidebar-section-children"><a href="external-i18nextBrowserLanguageDetector.html">i18nextBrowserLanguageDetector</a></div><div class="sidebar-section-children"><a href="external-i18nextHttpBackend.html">i18nextHttpBackend</a></div><div class="sidebar-section-children"><a href="external-jpeg.html">jpeg</a></div></div><div class="sidebar-section-title with-arrow" data-isopen="false" id="dIx1EF6rW_YdnipjQW6PA"><div>Modules</div><svg><use xlink:href="#down-icon"></use></svg></div><div class="sidebar-section-children-container"><div class="sidebar-section-children"><a href="module-tests_dicom.html">tests/dicom</a></div><div class="sidebar-section-children"><a href="module-tests_gui.html">tests/gui</a></div><div class="sidebar-section-children"><a href="module-tests_image.html">tests/image</a></div><div class="sidebar-section-children"><a href="module-tests_io.html">tests/io</a></div><div class="sidebar-section-children"><a href="module-tests_math.html">tests/math</a></div><div class="sidebar-section-children"><a href="module-tests_math.html">tests/math</a></div><div class="sidebar-section-children"><a href="module-tests_state.html">tests/state</a></div><div class="sidebar-section-children"><a href="module-tests_utils.html">tests/utils</a></div><div class="sidebar-section-children"><a href="module-tests_utils.html">tests/utils</a></div></div></div></div></div><div class="navbar-container" id="VuAckcnZhf"><nav class="navbar"><div class="navbar-left-items"><div class="navbar-item"><a id="" href="https://github.com/ivmartel/dwv" target="_blank">github</a></div><div class="navbar-item"><a id="" href="https://www.npmjs.com/package/dwv" target="_blank">npm</a></div></div><div class="navbar-right-items"><div class="navbar-right-item"><button class="icon-button search-button" aria-label="open-search"><svg><use xlink:href="#search-icon"></use></svg></button></div><div class="navbar-right-item"><button class="icon-button theme-toggle" aria-label="toggle-theme"><svg><use class="theme-svg-use" xlink:href="#light-theme-icon"></use></svg></button></div><div class="navbar-right-item"><button class="icon-button font-size" aria-label="change-font-size"><svg><use xlink:href="#font-size-icon"></use></svg></button></div></div><nav></nav></nav></div><div class="toc-container"><div class="toc-content"><span class="bold">On this page</span><div id="eed4d2a0bfd64539bb9df78095dec881"></div></div></div><div class="body-wrapper"><div class="main-content"><div class="main-wrapper"><section id="source-page" class="source-page"><header><h1 id="title" class="has-anchor">src_dicom_dicomWriter.js</h1></header><article><pre class="prettyprint source lang-js"><code>// namespaces
var dwv = dwv || {};
dwv.dicom = dwv.dicom || {};

/**
 * Get the dwv UID prefix.
 * Issued by Medical Connections Ltd (www.medicalconnections.co.uk)
 *   on 25/10/2017.
 *
 * @returns {string} The dwv UID prefix.
 */
dwv.dicom.getDwvUIDPrefix = function () {
  return '1.2.826.0.1.3680043.9.7278.1';
};

// local generated uid counter
var _uidCount = 0;

/**
 * Get a UID for a DICOM tag.
 * Note: Use https://github.com/uuidjs/uuid?
 *
 * @see http://dicom.nema.org/dicom/2013/output/chtml/part05/chapter_9.html
 * @see http://dicomiseasy.blogspot.com/2011/12/chapter-4-dicom-objects-in-chapter-3.html
 * @see https://stackoverflow.com/questions/46304306/how-to-generate-unique-dicom-uid
 * @param {string} tagName The input tag.
 * @returns {string} The corresponding UID.
 */
dwv.dicom.getUID = function (tagName) {
  var prefix = dwv.dicom.getDwvUIDPrefix() + '.';
  var uid = '';
  if (tagName === 'ImplementationClassUID') {
    uid = prefix + dwv.getVersion();
  } else {
    // date (only numbers), do not keep milliseconds
    var date = (new Date()).toISOString().replace(/\D/g, '');
    var datePart = '.' + date.substring(0, 14);
    // count
    _uidCount += 1;
    var countPart = '.' + _uidCount;

    // uid = prefix . tag . date . count
    uid = prefix;

    // limit tag part to not exceed 64 length
    var nonTagLength = prefix.length + countPart.length + datePart.length;
    var leni = Math.min(tagName.length, 64 - nonTagLength);
    if (leni > 1) {
      var tagNumber = '';
      for (var i = 0; i &lt; leni; ++i) {
        tagNumber += tagName.charCodeAt(i);
      }
      uid += tagNumber.substring(0, leni);
    }

    // finish
    uid += datePart + countPart;
  }
  return uid;
};

/**
 * Return true if the input number is even.
 *
 * @param {number} number The number to check.
 * @returns {boolean} True is the number is even.
 */
dwv.dicom.isEven = function (number) {
  return number % 2 === 0;
};

/**
 * Is the input VR a VR that stores data in a typed array.
 * TODO: include ox and xs?
 *
 * @param {string} vr The element VR.
 * @returns {boolean} True if the VR is a typed array one.
 */
dwv.dicom.isTypedArrayVr = function (vr) {
  var vrType = dwv.dicom.vrTypes[vr];
  return typeof vrType !== 'undefined' &amp;&amp;
    vrType !== 'string';
};

/**
 * Is the input VR a string VR.
 *
 * @param {string} vr The element VR.
 * @returns {boolean} True if the VR is a string one.
 */
dwv.dicom.isStringVr = function (vr) {
  var vrType = dwv.dicom.vrTypes[vr];
  return typeof vrType !== 'undefined' &amp;&amp;
    vrType === 'string';
};

/**
 * Is the input VR a VR that could need padding.
 * see http://dicom.nema.org/dicom/2013/output/chtml/part05/sect_6.2.html
 *
 * @param {string} vr The element VR.
 * @returns {boolean} True if the VR needs padding.
 */
dwv.dicom.isVrToPad = function (vr) {
  return dwv.dicom.isStringVr(vr) || vr === 'OB';
};

/**
 * Get the VR specific padding value.
 *
 * @param {string} vr The element VR.
 * @returns {boolean} The value used to pad.
 */
dwv.dicom.getVrPad = function (vr) {
  var pad = 0;
  if (dwv.dicom.isStringVr(vr)) {
    if (vr === 'UI') {
      pad = '\0';
    } else {
      pad = ' ';
    }
  }
  return pad;
};

/**
 * Push a value at the end of an input Uint8Array.
 *
 * @param {Uint8Array} arr The input array.
 * @param {number} value The value to push.
 * @returns {Uint8Array} The new array.
 */
dwv.dicom.uint8ArrayPush = function (arr, value) {
  var newArr = new Uint8Array(arr.length + 1);
  newArr.set(arr);
  newArr.set(value, arr.length);
  return newArr;
};

/**
 * Pad an input OB value.
 *
 * @param {Array|Uint8Array} value The input value.
 * @returns {Array|Uint8Array} The padded input.
 */
dwv.dicom.padOBValue = function (value) {
  if (value !== null &amp;&amp;
    typeof value !== 'undefined' &amp;&amp;
    typeof value.length !== 'undefined') {
    // calculate size and pad if needed
    if (value.length !== 0 &amp;&amp;
      typeof value[0].length !== 'undefined') {
      // handle array of array
      var size = 0;
      for (var i = 0; i &lt; value.length; ++i) {
        size += value[i].length;
      }
      if (!dwv.dicom.isEven(size)) {
        value[value.length - 1] = dwv.dicom.uint8ArrayPush(
          value[value.length - 1], 0);
      }
    } else {
      if (!dwv.dicom.isEven(value.length)) {
        value = dwv.dicom.uint8ArrayPush(value, 0);
      }
    }
  } else {
    throw new Error('Cannot pad undefined or null OB value.');
  }
  // uint8ArrayPush may create a new array so we
  // need to return it
  return value;
};

/**
 * Helper method to flatten an array of typed arrays to 2D typed array
 *
 * @param {Array} initialArray array of typed arrays
 * @returns {object} a typed array containing all values
 */
dwv.dicom.flattenArrayOfTypedArrays = function (initialArray) {
  var initialArrayLength = initialArray.length;
  var arrayLength = initialArray[0].length;
  // If this is not a array of arrays, just return the initial one:
  if (typeof arrayLength === 'undefined') {
    return initialArray;
  }

  var flattenendArrayLength = initialArrayLength * arrayLength;

  var flattenedArray = new initialArray[0].constructor(flattenendArrayLength);

  for (var i = 0; i &lt; initialArrayLength; i++) {
    var indexFlattenedArray = i * arrayLength;
    flattenedArray.set(initialArray[i], indexFlattenedArray);
  }
  return flattenedArray;
};

/**
 * Default text encoder.
 */
dwv.dicom.DefaultTextEncoder = function () {
  /**
   * Encode an input string.
   *
   * @param {string} str The string to encode.
   * @returns {Uint8Array} The encoded string.
   */
  this.encode = function (str) {
    var result = new Uint8Array(str.length);
    for (var i = 0, leni = str.length; i &lt; leni; ++i) {
      result[i] = str.charCodeAt(i);
    }
    return result;
  };
};

/**
 * DICOM writer.
 *
 * Example usage:
 *   var parser = new dwv.dicom.DicomParser();
 *   parser.parse(this.response);
 *
 *   var writer = new dwv.dicom.DicomWriter(parser.getRawDicomElements());
 *   var blob = new Blob([writer.getBuffer()], {type: 'application/dicom'});
 *
 *   var element = document.getElementById("download");
 *   element.href = URL.createObjectURL(blob);
 *   element.download = "anonym.dcm";
 *
 * @class
 */
dwv.dicom.DicomWriter = function () {

  // flag to use VR=UN for private sequences, default to false
  // (mainly used in tests)
  this.useUnVrForPrivateSq = false;

  // possible tag actions
  var actions = {
    copy: function (item) {
      return item;
    },
    remove: function () {
      return null;
    },
    clear: function (item) {
      item.value = [];
      return item;
    },
    replace: function (item, value) {
      item.value = [value];
      return item;
    }
  };

  // default rules: just copy
  var defaultRules = {
    default: {action: 'copy', value: null}
  };

  /**
   * Public (modifiable) rules.
   * Set of objects as:
   *   name : { action: 'actionName', value: 'optionalValue }
   * The names are either 'default', tagName or groupName.
   * Each DICOM element will be checked to see if a rule is applicable.
   * First checked by tagName and then by groupName,
   * if nothing is found the default rule is applied.
   */
  this.rules = defaultRules;

  /**
   * Default text encoder.
   *
   * @private
   * @type {dwv.dicom.DefaultTextEncoder}
   */
  var defaultTextEncoder = new dwv.dicom.DefaultTextEncoder();

  /**
   * Special text encoder.
   *
   * @private
   * @type {dwv.dicom.DefaultTextEncoder|TextEncoder}
   */
  var textEncoder = defaultTextEncoder;

  /**
   * Encode string data.
   *
   * @param {number} str The string to encode.
   * @returns {Uint8Array} The encoded string.
   */
  this.encodeString = function (str) {
    return defaultTextEncoder.encode(str);
  };

  /**
   * Encode data as a UTF-8.
   *
   * @param {number} str The string to write.
   * @returns {Uint8Array} The encoded string.
   */
  this.encodeSpecialString = function (str) {
    return textEncoder.encode(str);
  };

  /**
   * Use a TextEncoder instead of the default text decoder.
   */
  this.useSpecialTextEncoder = function () {
    /**
     * The text encoder.
     *
     * @external TextEncoder
     * @see https://developer.mozilla.org/en-US/docs/Web/API/TextEncoder
     */
    textEncoder = new TextEncoder();
  };

  /**
   * Example anonymisation rules.
   */
  this.anonymisationRules = {
    default: {action: 'remove', value: null},
    PatientName: {action: 'replace', value: 'Anonymized'}, // tag
    'Meta Element': {action: 'copy', value: null}, // group 'x0002'
    Acquisition: {action: 'copy', value: null}, // group 'x0018'
    'Image Presentation': {action: 'copy', value: null}, // group 'x0028'
    Procedure: {action: 'copy', value: null}, // group 'x0040'
    'Pixel Data': {action: 'copy', value: null} // group 'x7fe0'
  };

  /**
   * Get the element to write according to the class rules.
   * Priority order: tagName, groupName, default.
   *
   * @param {object} element The element to check
   * @returns {object} The element to write, can be null.
   */
  this.getElementToWrite = function (element) {
    // get group and tag string name
    var groupName = element.tag.getGroupName();
    var tagName = element.tag.getNameFromDictionary();

    // apply rules:
    var rule;
    if (typeof this.rules[element.tag.getKey()] !== 'undefined') {
      // 1. tag itself
      rule = this.rules[element.tag.getKey()];
    } else if (tagName !== null &amp;&amp; typeof this.rules[tagName] !== 'undefined') {
      // 2. tag name
      rule = this.rules[tagName];
    } else if (typeof this.rules[groupName] !== 'undefined') {
      // 3. group name
      rule = this.rules[groupName];
    } else {
      // 4. default
      rule = this.rules['default'];
    }
    // apply action on element and return
    return actions[rule.action](element, rule.value);
  };
};

/**
 * Write a list of items.
 *
 * @param {dwv.dicom.DataWriter} writer The raw data writer.
 * @param {number} byteOffset The offset to start writing from.
 * @param {Array} items The list of items to write.
 * @param {boolean} isImplicit Is the DICOM VR implicit?
 * @returns {number} The new offset position.
 */
dwv.dicom.DicomWriter.prototype.writeDataElementItems = function (
  writer, byteOffset, items, isImplicit) {
  var item = null;
  for (var i = 0; i &lt; items.length; ++i) {
    item = items[i];
    var itemKeys = Object.keys(item);
    if (itemKeys.length === 0) {
      continue;
    }
    // item element (create new to not modify original)
    var undefinedLength = false;
    if (typeof item.xFFFEE000.undefinedLength !== 'undefined') {
      undefinedLength = item.xFFFEE000.undefinedLength;
    }
    var itemElement = {
      tag: dwv.dicom.getItemTag(),
      vr: 'NONE',
      vl: undefinedLength ? 0xffffffff : item.xFFFEE000.vl,
      value: []
    };
    byteOffset = this.writeDataElement(
      writer, itemElement, byteOffset, isImplicit);
    // write rest
    for (var m = 0; m &lt; itemKeys.length; ++m) {
      if (itemKeys[m] !== 'xFFFEE000' &amp;&amp; itemKeys[m] !== 'xFFFEE00D') {
        byteOffset = this.writeDataElement(
          writer, item[itemKeys[m]], byteOffset, isImplicit);
      }
    }
    // item delimitation
    if (undefinedLength) {
      var itemDelimElement = {
        tag: dwv.dicom.getItemDelimitationItemTag(),
        vr: 'NONE',
        vl: 0,
        value: []
      };
      byteOffset = this.writeDataElement(
        writer, itemDelimElement, byteOffset, isImplicit);
    }
  }

  // return new offset
  return byteOffset;
};

/**
 * Write data with a specific Value Representation (VR).
 *
 * @param {dwv.dicom.DataWriter} writer The raw data writer.
 * @param {object} element The element to write.
 * @param {number} byteOffset The offset to start writing from.
 * @param {Array} value The array to write.
 * @param {boolean} isImplicit Is the DICOM VR implicit?
 * @returns {number} The new offset position.
 */
dwv.dicom.DicomWriter.prototype.writeDataElementValue = function (
  writer, element, byteOffset, value, isImplicit) {

  var startOffset = byteOffset;

  if (element.vr === 'NONE') {
    // nothing to do!
  } else if (value instanceof Uint8Array) {
    // binary data has been expanded 8 times at read
    if (value.length === 8 * element.vl) {
      byteOffset = writer.writeBinaryArray(byteOffset, value);
    } else {
      byteOffset = writer.writeUint8Array(byteOffset, value);
    }
  } else if (value instanceof Int8Array) {
    byteOffset = writer.writeInt8Array(byteOffset, value);
  } else if (value instanceof Uint16Array) {
    byteOffset = writer.writeUint16Array(byteOffset, value);
  } else if (value instanceof Int16Array) {
    byteOffset = writer.writeInt16Array(byteOffset, value);
  } else if (value instanceof Uint32Array) {
    byteOffset = writer.writeUint32Array(byteOffset, value);
  } else if (value instanceof Int32Array) {
    byteOffset = writer.writeInt32Array(byteOffset, value);
  } else if (value instanceof BigUint64Array) {
    byteOffset = writer.writeUint64Array(byteOffset, value);
  } else if (value instanceof BigInt64Array) {
    byteOffset = writer.writeInt64Array(byteOffset, value);
  } else {
    // switch according to VR if input type is undefined
    var vrType = dwv.dicom.vrTypes[element.vr];
    if (typeof vrType !== 'undefined') {
      if (vrType === 'Uint8') {
        byteOffset = writer.writeUint8Array(byteOffset, value);
      } else if (vrType === 'Uint16') {
        byteOffset = writer.writeUint16Array(byteOffset, value);
      } else if (vrType === 'Int16') {
        byteOffset = writer.writeInt16Array(byteOffset, value);
      } else if (vrType === 'Uint32') {
        byteOffset = writer.writeUint32Array(byteOffset, value);
      } else if (vrType === 'Int32') {
        byteOffset = writer.writeInt32Array(byteOffset, value);
      } else if (vrType === 'Uint64') {
        byteOffset = writer.writeUint64Array(byteOffset, value);
      } else if (vrType === 'Int64') {
        byteOffset = writer.writeInt64Array(byteOffset, value);
      } else if (vrType === 'Float32') {
        byteOffset = writer.writeFloat32Array(byteOffset, value);
      } else if (vrType === 'Float64') {
        byteOffset = writer.writeFloat64Array(byteOffset, value);
      } else if (vrType === 'string') {
        byteOffset = writer.writeUint8Array(byteOffset, value);
      } else {
        throw Error('Unknown VR type: ' + vrType);
      }
    } else if (element.vr === 'SQ') {
      byteOffset = this.writeDataElementItems(
        writer, byteOffset, value, isImplicit);
    } else if (element.vr === 'AT') {
      for (var i = 0; i &lt; value.length; ++i) {
        var hexString = value[i] + '';
        var hexString1 = hexString.substring(1, 5);
        var hexString2 = hexString.substring(6, 10);
        var dec1 = parseInt(hexString1, 16);
        var dec2 = parseInt(hexString2, 16);
        var atValue = new Uint16Array([dec1, dec2]);
        byteOffset = writer.writeUint16Array(byteOffset, atValue);
      }
    } else {
      dwv.logger.warn('Unknown VR: ' + element.vr);
    }
  }

  if (element.vr !== 'SQ' &amp;&amp; element.vr !== 'NONE') {
    var diff = byteOffset - startOffset;
    if (diff !== element.vl) {
      dwv.logger.warn('Offset difference and VL are not equal: ' +
        diff + ' != ' + element.vl + ', vr:' + element.vr);
    }
  }

  // return new offset
  return byteOffset;
};

/**
 * Write a pixel data element.
 *
 * @param {dwv.dicom.DataWriter} writer The raw data writer.
 * @param {object} element The element to write.
 * @param {number} byteOffset The offset to start writing from.
 * @param {Array} value The array to write.
 * @param {boolean} isImplicit Is the DICOM VR implicit?
 * @returns {number} The new offset position.
 */
dwv.dicom.DicomWriter.prototype.writePixelDataElementValue = function (
  writer, element, byteOffset, value, isImplicit) {
  // undefined length flag
  var undefinedLength = false;
  if (typeof element.undefinedLength !== 'undefined') {
    undefinedLength = element.undefinedLength;
  }
  // explicit length
  if (!undefinedLength) {
    var finalValue = value[0];
    // flatten multi frame
    if (value.length > 1) {
      finalValue = dwv.dicom.flattenArrayOfTypedArrays(value);
    }
    // write
    byteOffset = this.writeDataElementValue(
      writer, element, byteOffset, finalValue, isImplicit);
  } else {
    // pixel data as sequence
    var item = {};
    // first item: basic offset table
    item.xFFFEE000 = {
      tag: dwv.dicom.getItemTag(),
      vr: 'NONE',
      vl: 0,
      value: []
    };
    // data
    for (var i = 0; i &lt; value.length; ++i) {
      item[i] = {
        tag: dwv.dicom.getItemTag(),
        vr: element.vr,
        vl: value[i].length,
        value: value[i]
      };
    }
    // write
    byteOffset = this.writeDataElementItems(
      writer, byteOffset, [item], isImplicit);
  }

  // return new offset
  return byteOffset;
};

/**
 * Write a data element.
 *
 * @param {dwv.dicom.DataWriter} writer The raw data writer.
 * @param {object} element The DICOM data element to write.
 * @param {number} byteOffset The offset to start writing from.
 * @param {boolean} isImplicit Is the DICOM VR implicit?
 * @returns {number} The new offset position.
 */
dwv.dicom.DicomWriter.prototype.writeDataElement = function (
  writer, element, byteOffset, isImplicit) {
  var isTagWithVR = element.tag.isWithVR();
  var is32bitVLVR = (isImplicit || !isTagWithVR)
    ? true : dwv.dicom.is32bitVLVR(element.vr);
  // group
  byteOffset = writer.writeHex(byteOffset, element.tag.getGroup());
  // element
  byteOffset = writer.writeHex(byteOffset, element.tag.getElement());
  // VR
  var vr = element.vr;
  // use VR=UN for private sequence
  if (this.useUnVrForPrivateSq &amp;&amp;
    element.tag.isPrivate() &amp;&amp;
    vr === 'SQ') {
    dwv.logger.warn('Write element using VR=UN for private sequence.');
    vr = 'UN';
  }
  if (isTagWithVR &amp;&amp; !isImplicit) {
    byteOffset = writer.writeUint8Array(byteOffset, this.encodeString(vr));
    // reserved 2 bytes for 32bit VL
    if (is32bitVLVR) {
      byteOffset += 2;
    }
  }

  var undefinedLengthSequence = false;
  if (element.vr === 'SQ' ||
    dwv.dicom.isPixelDataTag(element.tag)) {
    if (typeof element.undefinedLength !== 'undefined') {
      undefinedLengthSequence = element.undefinedLength;
    }
  }
  var undefinedLengthItem = false;
  if (dwv.dicom.isItemTag(element.tag)) {
    if (typeof element.undefinedLength !== 'undefined') {
      undefinedLengthItem = element.undefinedLength;
    }
  }

  // update vl for sequence or item with undefined length
  var vl = element.vl;
  if (undefinedLengthSequence || undefinedLengthItem) {
    vl = 0xffffffff;
  }
  // VL
  if (is32bitVLVR) {
    byteOffset = writer.writeUint32(byteOffset, vl);
  } else {
    byteOffset = writer.writeUint16(byteOffset, vl);
  }

  // value
  var value = element.value;
  // check value
  if (typeof value === 'undefined') {
    value = [];
  }
  // write
  if (dwv.dicom.isPixelDataTag(element.tag)) {
    byteOffset = this.writePixelDataElementValue(
      writer, element, byteOffset, value, isImplicit);
  } else {
    byteOffset = this.writeDataElementValue(
      writer, element, byteOffset, value, isImplicit);
  }

  // sequence delimitation item for sequence with undefined length
  if (undefinedLengthSequence) {
    var seqDelimElement = {
      tag: dwv.dicom.getSequenceDelimitationItemTag(),
      vr: 'NONE',
      vl: 0,
      value: []
    };
    byteOffset = this.writeDataElement(
      writer, seqDelimElement, byteOffset, isImplicit);
  }

  // return new offset
  return byteOffset;
};

/**
 * Get the ArrayBuffer corresponding to input DICOM elements.
 *
 * @param {Array} dicomElements The wrapped elements to write.
 * @returns {ArrayBuffer} The elements as a buffer.
 */
dwv.dicom.DicomWriter.prototype.getBuffer = function (dicomElements) {
  // Transfer Syntax
  var syntax = dwv.dicom.cleanString(dicomElements.x00020010.value[0]);
  var isImplicit = dwv.dicom.isImplicitTransferSyntax(syntax);
  var isBigEndian = dwv.dicom.isBigEndianTransferSyntax(syntax);
  // Specific CharacterSet
  if (typeof dicomElements.x00080005 !== 'undefined') {
    var oldscs = dwv.dicom.cleanString(dicomElements.x00080005.value[0]);
    // force UTF-8 if not default character set
    if (typeof oldscs !== 'undefined' &amp;&amp; oldscs !== 'ISO-IR 6') {
      dwv.logger.debug('Change charset to UTF, was: ' + oldscs);
      this.useSpecialTextEncoder();
      dicomElements.x00080005.value = ['ISO_IR 192'];
    }
  }
  // Bits Allocated (for image data)
  var bitsAllocated;
  if (typeof dicomElements.x00280100 !== 'undefined') {
    bitsAllocated = dicomElements.x00280100.value[0];
  }

  // calculate buffer size and split elements (meta and non meta)
  var totalSize = 128 + 4; // DICM
  var localSize = 0;
  var metaElements = [];
  var rawElements = [];
  var element;
  var groupName;
  var metaLength = 0;
  // FileMetaInformationGroupLength
  var fmiglTag = dwv.dicom.getFileMetaInformationGroupLengthTag();
  // FileMetaInformationVersion
  var fmivTag = new dwv.dicom.Tag('0x0002', '0x0001');
  // ImplementationClassUID
  var icUIDTag = new dwv.dicom.Tag('0x0002', '0x0012');
  // ImplementationVersionName
  var ivnTag = new dwv.dicom.Tag('0x0002', '0x0013');

  // loop through elements to get the buffer size
  var keys = Object.keys(dicomElements);
  for (var i = 0, leni = keys.length; i &lt; leni; ++i) {
    element = this.getElementToWrite(dicomElements[keys[i]]);
    if (element !== null &amp;&amp;
       !fmiglTag.equals(element.tag) &amp;&amp;
       !fmivTag.equals(element.tag) &amp;&amp;
       !icUIDTag.equals(element.tag) &amp;&amp;
       !ivnTag.equals(element.tag)) {
      localSize = 0;

      // XB7 2020-04-17
      // Check if UN can be converted to correct VR.
      // This check must be done BEFORE calculating totalSize,
      // otherwise there may be extra null bytes at the end of the file
      // (dcmdump may crash because of these bytes)
      dwv.dicom.checkUnknownVR(element);

      // update value and vl
      this.setElementValue(
        element, element.value, isImplicit, bitsAllocated);

      // tag group name
      groupName = element.tag.getGroupName();

      // prefix
      if (groupName === 'Meta Element') {
        localSize += dwv.dicom.getDataElementPrefixByteSize(element.vr, false);
      } else {
        localSize += dwv.dicom.getDataElementPrefixByteSize(
          element.vr, isImplicit);
      }

      // value
      localSize += element.vl;

      // sort elements
      if (groupName === 'Meta Element') {
        metaElements.push(element);
        metaLength += localSize;
      } else {
        rawElements.push(element);
      }

      // add to total size
      totalSize += localSize;
    }
  }

  // FileMetaInformationVersion
  var fmiv = dwv.dicom.getDicomElement('FileMetaInformationVersion');
  var fmivSize = dwv.dicom.getDataElementPrefixByteSize(fmiv.vr, false);
  fmivSize += this.setElementValue(fmiv, [0, 1], false);
  metaElements.push(fmiv);
  metaLength += fmivSize;
  totalSize += fmivSize;
  // ImplementationClassUID
  var icUID = dwv.dicom.getDicomElement('ImplementationClassUID');
  var icUIDSize = dwv.dicom.getDataElementPrefixByteSize(icUID.vr, false);
  icUIDSize += this.setElementValue(
    icUID, [dwv.dicom.getUID('ImplementationClassUID')], false);
  metaElements.push(icUID);
  metaLength += icUIDSize;
  totalSize += icUIDSize;
  // ImplementationVersionName
  var ivn = dwv.dicom.getDicomElement('ImplementationVersionName');
  var ivnSize = dwv.dicom.getDataElementPrefixByteSize(ivn.vr, false);
  var ivnValue = 'DWV_' + dwv.getVersion();
  ivnSize += this.setElementValue(ivn, [ivnValue], false);
  metaElements.push(ivn);
  metaLength += ivnSize;
  totalSize += ivnSize;

  // sort elements
  var elemSortFunc = function (a, b) {
    return dwv.dicom.tagCompareFunction(a.tag, b.tag);
  };
  metaElements.sort(elemSortFunc);
  rawElements.sort(elemSortFunc);

  // create the FileMetaInformationGroupLength element
  var fmigl = dwv.dicom.getDicomElement('FileMetaInformationGroupLength');
  var fmiglSize = dwv.dicom.getDataElementPrefixByteSize(fmigl.vr, false);
  fmiglSize += this.setElementValue(
    fmigl, new Uint32Array([metaLength]), false);
  totalSize += fmiglSize;

  // create buffer
  var buffer = new ArrayBuffer(totalSize);
  var metaWriter = new dwv.dicom.DataWriter(buffer);
  var dataWriter = new dwv.dicom.DataWriter(buffer, !isBigEndian);

  var offset = 128;
  // DICM
  offset = metaWriter.writeUint8Array(offset, this.encodeString('DICM'));
  // FileMetaInformationGroupLength
  offset = this.writeDataElement(metaWriter, fmigl, offset, false);
  // write meta
  for (var j = 0, lenj = metaElements.length; j &lt; lenj; ++j) {
    offset = this.writeDataElement(metaWriter, metaElements[j], offset, false);
  }

  // check meta position
  var preambleSize = 128 + 4;
  var metaOffset = preambleSize + fmiglSize + metaLength;
  if (offset !== metaOffset) {
    dwv.logger.warn('Bad size calculation... meta offset: ' + offset +
      ', calculated size:' + metaOffset +
      ' (diff:' + (offset - metaOffset) + ')');
  }

  // pass flag to writer
  dataWriter.useUnVrForPrivateSq = this.useUnVrForPrivateSq;
  // write non meta
  for (var k = 0, lenk = rawElements.length; k &lt; lenk; ++k) {
    offset = this.writeDataElement(
      dataWriter, rawElements[k], offset, isImplicit);
  }

  // check final position
  if (offset !== totalSize) {
    dwv.logger.warn('Bad size calculation... final offset: ' + offset +
      ', calculated size:' + totalSize +
      ' (diff:' + (offset - totalSize) + ')');
  }
  // return
  return buffer;
};

/**
 * Fix for broken DICOM elements: Replace "UN" with correct VR if the
 * element exists in dictionary
 *
 * @param {object} element The DICOM element.
 */
dwv.dicom.checkUnknownVR = function (element) {
  if (element.vr === 'UN') {
    var dictVr = element.tag.getVrFromDictionary();
    if (dictVr !== null &amp;&amp; element.vr !== dictVr) {
      element.vr = dictVr;
      dwv.logger.info('Element ' + element.tag.getGroup() +
        ' ' + element.tag.getElement() +
        ' VR changed from UN to ' + element.vr);
    }
  }
};

/**
 * Get a DICOM element from its tag name (value set separatly).
 *
 * @param {string} tagName The string tag name.
 * @returns {object} The DICOM element.
 */
dwv.dicom.getDicomElement = function (tagName) {
  var tag = dwv.dicom.getTagFromDictionary(tagName);
  return {
    tag: tag,
    vr: tag.getVrFromDictionary()
  };
};

/**
 * Get the number of bytes per element for a given VR type.
 *
 * @param {string} vrType The VR type as defined in the dictionary.
 * @returns {number} The bytes per element.
 */
dwv.dicom.getBpeForVrType = function (vrType) {
  var bpe;
  if (vrType === 'Uint8') {
    bpe = Uint8Array.BYTES_PER_ELEMENT;
  } else if (vrType === 'Uint16') {
    bpe = Uint16Array.BYTES_PER_ELEMENT;
  } else if (vrType === 'Int16') {
    bpe = Int16Array.BYTES_PER_ELEMENT;
  } else if (vrType === 'Uint32') {
    bpe = Uint32Array.BYTES_PER_ELEMENT;
  } else if (vrType === 'Int32') {
    bpe = Int32Array.BYTES_PER_ELEMENT;
  } else if (vrType === 'Float32') {
    bpe = Float32Array.BYTES_PER_ELEMENT;
  } else if (vrType === 'Float64') {
    bpe = Float64Array.BYTES_PER_ELEMENT;
  } else if (vrType === 'Uint64') {
    bpe = BigUint64Array.BYTES_PER_ELEMENT;
  } else if (vrType === 'Int64') {
    bpe = BigInt64Array.BYTES_PER_ELEMENT;
  }
  return bpe;
};

/**
 * Set a DICOM element value according to its VR (Value Representation).
 *
 * @param {object} element The DICOM element to set the value.
 * @param {object} value The value to set.
 * @param {boolean} isImplicit Does the data use implicit VR?
 * @param {number} bitsAllocated Bits allocated used for pixel data.
 * @returns {number} The total element size.
 */
dwv.dicom.DicomWriter.prototype.setElementValue = function (
  element, value, isImplicit, bitsAllocated) {
  // byte size of the element
  var size = 0;
  // special sequence case
  if (element.vr === 'SQ') {

    if (value !== null &amp;&amp; value !== 0) {
      var newItems = [];
      var name;

      // explicit or undefined length sequence
      var undefinedLength = false;
      if (typeof element.undefinedLength !== 'undefined') {
        undefinedLength = element.undefinedLength;
        delete element.undefinedLength;
      }

      // items
      for (var i = 0; i &lt; value.length; ++i) {
        var oldItemElements = value[i];
        var newItemElements = {};
        var subSize = 0;

        // check data
        if (oldItemElements === null || oldItemElements === 0) {
          continue;
        }

        // elements
        var itemKeys = Object.keys(oldItemElements);
        for (var j = 0, lenj = itemKeys.length; j &lt; lenj; ++j) {
          var itemKey = itemKeys[j];
          var subElement = oldItemElements[itemKey];
          if (dwv.dicom.isItemTag(subElement.tag)) {
            continue;
          }
          // set item value
          subSize += this.setElementValue(
            subElement, subElement.value, isImplicit, bitsAllocated);
          newItemElements[itemKey] = subElement;
          // add prefix size
          subSize += dwv.dicom.getDataElementPrefixByteSize(
            subElement.vr, isImplicit);
        }

        // add item element (used to store its size)
        var itemElement = {
          tag: dwv.dicom.getItemTag(),
          vr: 'NONE',
          vl: subSize,
          value: []
        };
        if (undefinedLength) {
          itemElement.undefinedLength = undefinedLength;
        }
        name = itemElement.tag.getKey();
        newItemElements[name] = itemElement;
        subSize += dwv.dicom.getDataElementPrefixByteSize(
          itemElement.vr, isImplicit);

        // add item delimitation size
        if (undefinedLength) {
          subSize += dwv.dicom.getDataElementPrefixByteSize(
            'NONE', isImplicit);
        }

        size += subSize;
        newItems.push(newItemElements);
      }

      // add sequence delimitation size
      if (undefinedLength) {
        size += dwv.dicom.getDataElementPrefixByteSize('NONE', isImplicit);
      }

      // update sequence element
      element.value = newItems;
      element.vl = size;
      if (undefinedLength) {
        element.undefinedLength = undefinedLength;
      }
    }
  } else {
    // pad if necessary
    if (dwv.dicom.isVrToPad(element.vr)) {
      var pad = dwv.dicom.getVrPad(element.vr);
      // encode string
      // TODO: not sure for UN...
      if (dwv.dicom.isStringVr(element.vr)) {
        if (dwv.dicom.charSetString.includes(element.vr)) {
          value = this.encodeSpecialString(value.join('\\'));
          pad = this.encodeSpecialString(pad);
        } else {
          value = this.encodeString(value.join('\\'));
          pad = this.encodeString(pad);
        }
        if (!dwv.dicom.isEven(value.length)) {
          value = dwv.dicom.uint8ArrayPush(value, pad);
        }
      } else if (element.vr === 'OB') {
        value = dwv.dicom.padOBValue(value);
      }
    }

    // calculate byte size
    size = 0;
    if (element.vr === 'AT') {
      size = 4 * value.length;
    } else if (element.vr === 'xs') {
      size = value.length * Uint16Array.BYTES_PER_ELEMENT;
    } else if (dwv.dicom.isTypedArrayVr(element.vr) || element.vr === 'ox') {
      if (dwv.dicom.isPixelDataTag(element.tag) &amp;&amp;
        Array.isArray(value)) {
        size = 0;
        for (var b = 0; b &lt; value.length; ++b) {
          size += value[b].length;
        }
      } else {
        size = value.length;
      }

      // convert size to bytes
      var vrType = dwv.dicom.vrTypes[element.vr];
      if (dwv.dicom.isPixelDataTag(element.tag) || element.vr === 'ox') {
        if (element.undefinedLength) {
          var itemPrefixSize =
            dwv.dicom.getDataElementPrefixByteSize('NONE', isImplicit);
          // offset table
          size += itemPrefixSize;
          // pixel items
          size += itemPrefixSize * value.length;
          // add sequence delimitation size
          size += itemPrefixSize;
        } else {
          // use bitsAllocated for pixel data
          // no need to multiply for 8 bits
          if (typeof bitsAllocated !== 'undefined') {
            if (bitsAllocated === 1) {
              // binary data
              size /= 8;
            } else if (bitsAllocated === 16) {
              size *= Uint16Array.BYTES_PER_ELEMENT;
            }
          }
        }
      } else if (typeof vrType !== 'undefined') {
        var bpe = dwv.dicom.getBpeForVrType(vrType);
        if (typeof bpe !== 'undefined') {
          size *= bpe;
        } else {
          throw Error('Unknown bytes per element for VR type: ' + vrType);
        }
      } else {
        throw Error('Unsupported element: ' + element.vr);
      }
    } else {
      size = value.length;
    }

    element.value = value;
    element.vl = size;
  }

  // return the size of that data
  return size;
};

/**
 * Get the DICOM elements from a DICOM json tags object.
 * The json is a simplified version of the oficial DICOM json with
 * tag names instead of keys and direct values (no value property) for
 * simple tags.
 *
 * @param {object} jsonTags The DICOM json tags object.
 * @returns {object} The DICOM elements.
 */
dwv.dicom.getElementsFromJSONTags = function (jsonTags) {
  var keys = Object.keys(jsonTags);
  var dicomElements = {};
  for (var k = 0, len = keys.length; k &lt; len; ++k) {
    // get the DICOM element definition from its name
    var tag = dwv.dicom.getTagFromDictionary(keys[k]);
    if (!tag) {
      continue;
    }
    var vr = tag.getVrFromDictionary();
    // tag value
    var value;
    var undefinedLength = false;
    var jsonTag = jsonTags[keys[k]];
    if (vr === 'SQ') {
      var items = [];
      if (typeof jsonTag.undefinedLength !== 'undefined') {
        undefinedLength = jsonTag.undefinedLength;
      }
      if (typeof jsonTag.value !== 'undefined' &amp;&amp;
        jsonTag.value !== null) {
        for (var i = 0; i &lt; jsonTag.value.length; ++i) {
          items.push(dwv.dicom.getElementsFromJSONTags(jsonTag.value[i]));
        }
      } else {
        dwv.logger.trace('Undefined or null jsonTag SQ value.');
      }
      value = items;
    } else {
      if (Array.isArray(jsonTag)) {
        value = jsonTag;
      } else {
        value = [jsonTag];
      }
    }
    // create element
    var dicomElement = {
      tag: tag,
      vr: vr,
      value: value
    };
    if (undefinedLength) {
      dicomElement.undefinedLength = undefinedLength;
    }
    // store
    dicomElements[tag.getKey()] = dicomElement;
  }
  // return
  return dicomElements;
};
</code></pre></article></section><footer class="footer" id="PeOAagUepe"><div class="wrapper"><i>Documentation generated for dwv v0.31.0-rc.0.</i></div></footer></div></div></div><div class="search-container" id="PkfLWpAbet" style="display:none"><div class="wrapper" id="iCxFxjkHbP"><button class="icon-button search-close-button" id="VjLlGakifb" aria-label="close search"><svg><use xlink:href="#close-icon"></use></svg></button><div class="search-box-c"><svg><use xlink:href="#search-icon"></use></svg> <input type="text" id="vpcKVYIppa" class="search-input" placeholder="Search..." autofocus></div><div class="search-result-c" id="fWwVHRuDuN"><span class="search-result-c-text">Type anything to view search result</span></div></div></div><div class="mobile-menu-icon-container"><button class="icon-button" id="mobile-menu" data-isopen="false" aria-label="menu"><svg><use xlink:href="#menu-icon"></use></svg></button></div><div id="mobile-sidebar" class="mobile-sidebar-container"><div class="mobile-sidebar-wrapper"><a href="/" class="sidebar-title sidebar-title-anchor">DWV doc</a><div class="mobile-nav-links"><div class="navbar-item"><a id="" href="https://github.com/ivmartel/dwv" target="_blank">github</a></div><div class="navbar-item"><a id="" href="https://www.npmjs.com/package/dwv" target="_blank">npm</a></div></div><div class="mobile-sidebar-items-c"><div class="sidebar-section-title with-arrow" data-isopen="false" id="gMKB9jkVlMTZFjQFvZ078"><div>Tutorials</div><svg><use xlink:href="#down-icon"></use></svg></div><div class="sidebar-section-children-container"><div class="sidebar-section-children"><a href="tutorial-architecture.html">architecture</a></div><div class="sidebar-section-children"><a href="tutorial-conformance.html">conformance</a></div><div class="sidebar-section-children"><a href="tutorial-developing.html">developing</a></div><div class="sidebar-section-children"><a href="tutorial-errors.html">errors</a></div><div class="sidebar-section-children"><a href="tutorial-examples.html">examples</a></div><div class="sidebar-section-children"><a href="tutorial-integrations.html">integrations</a></div><div class="sidebar-section-children"><a href="tutorial-module.html">module</a></div><div class="sidebar-section-children"><a href="tutorial-standards.html">standards</a></div><div class="sidebar-section-children"><a href="tutorial-user-stories.html">user-stories</a></div></div><div class="sidebar-section-title with-arrow" data-isopen="false" id="XMnq3KWHu5us0GuiC_tcf"><div>Namespaces</div><svg><use xlink:href="#down-icon"></use></svg></div><div class="sidebar-section-children-container"><div class="sidebar-section-children"><a href="dwv.html">dwv</a></div><div class="sidebar-section-children"><a href="dwv.ctrl.html">ctrl</a></div><div class="sidebar-section-children"><a href="dwv.dicom.html">dicom</a></div><div class="sidebar-section-children"><a href="dwv.env.html">env</a></div><div class="sidebar-section-children"><a href="dwv.gui.html">gui</a></div><div class="sidebar-section-children"><a href="dwv.image.html">image</a></div><div class="sidebar-section-children"><a href="dwv.image.filter.html">filter</a></div><div class="sidebar-section-children"><a href="dwv.image.lut.html">lut</a></div><div class="sidebar-section-children"><a href="dwv.io.html">io</a></div><div class="sidebar-section-children"><a href="dwv.math.html">math</a></div><div class="sidebar-section-children"><a href="dwv.test.html">test</a></div><div class="sidebar-section-children"><a href="dwv.tool.html">tool</a></div><div class="sidebar-section-children"><a href="dwv.tool.draw_.html">draw</a></div><div class="sidebar-section-children"><a href="dwv.tool.filter_.html">filter</a></div><div class="sidebar-section-children"><a href="dwv.utils.html">utils</a></div><div class="sidebar-section-children"><a href="dwv.utils.logger.html">logger</a></div><div class="sidebar-section-children"><a href="dwv.utils.logger.console.html">console</a></div></div><div class="sidebar-section-title with-arrow" data-isopen="false" id="XB1UeGrgiPqtbCK7EE0_T"><div>Events</div><svg><use xlink:href="#down-icon"></use></svg></div><div class="sidebar-section-children-container"><div class="sidebar-section-children"><a href="dwv.App.html#event:keydown">keydown</a></div><div class="sidebar-section-children"><a href="dwv.App.html#event:load">load</a></div><div class="sidebar-section-children"><a href="dwv.App.html#event:loadabort">loadabort</a></div><div class="sidebar-section-children"><a href="dwv.App.html#event:loadend">loadend</a></div><div class="sidebar-section-children"><a href="dwv.App.html#event:loaderror">loaderror</a></div><div class="sidebar-section-children"><a href="dwv.App.html#event:loaditem">loaditem</a></div><div class="sidebar-section-children"><a href="dwv.App.html#event:loadprogress">loadprogress</a></div><div class="sidebar-section-children"><a href="dwv.App.html#event:loadstart">loadstart</a></div><div class="sidebar-section-children"><a href="dwv.App.html#event:opacitychange">opacitychange</a></div><div class="sidebar-section-children"><a href="dwv.App.html#event:renderend">renderend</a></div><div class="sidebar-section-children"><a href="dwv.App.html#event:renderstart">renderstart</a></div><div class="sidebar-section-children"><a href="dwv.ctrl.LayerGroup.html#event:offsetchange">offsetchange</a></div><div class="sidebar-section-children"><a href="dwv.ctrl.LayerGroup.html#event:zoomchange">zoomchange</a></div><div class="sidebar-section-children"><a href="dwv.image.DeleteSegmentCommand.html#event:masksegmentdelete">masksegmentdelete</a></div><div class="sidebar-section-children"><a href="dwv.image.DeleteSegmentCommand.html#event:masksegmentredraw">masksegmentredraw</a></div><div class="sidebar-section-children"><a href="dwv.image.Image.html#event:imagechange">imagechange</a></div><div class="sidebar-section-children"><a href="dwv.image.View.html#event:alphafuncchange">alphafuncchange</a></div><div class="sidebar-section-children"><a href="dwv.image.View.html#event:colourchange">colourchange</a></div><div class="sidebar-section-children"><a href="dwv.image.View.html#event:positionchange">positionchange</a></div><div class="sidebar-section-children"><a href="dwv.image.View.html#event:wlchange">wlchange</a></div><div class="sidebar-section-children"><a href="dwv.image.View.html#event:wlpresetadd">wlpresetadd</a></div><div class="sidebar-section-children"><a href="dwv.tool.ChangeGroupCommand.html#event:drawchange">drawchange</a></div><div class="sidebar-section-children"><a href="dwv.tool.DeleteGroupCommand.html#event:drawdelete">drawdelete</a></div><div class="sidebar-section-children"><a href="dwv.tool.DrawGroupCommand.html#event:drawcreate">drawcreate</a></div><div class="sidebar-section-children"><a href="dwv.tool.MoveGroupCommand.html#event:drawmove">drawmove</a></div><div class="sidebar-section-children"><a href="dwv.tool.RunFilterCommand.html#event:filterrun">filterrun</a></div><div class="sidebar-section-children"><a href="dwv.tool.RunFilterCommand.html#event:filterundo">filterundo</a></div><div class="sidebar-section-children"><a href="dwv.tool.UndoStack.html#event:redo">redo</a></div><div class="sidebar-section-children"><a href="dwv.tool.UndoStack.html#event:undo">undo</a></div><div class="sidebar-section-children"><a href="dwv.tool.UndoStack.html#event:undoadd">undoadd</a></div></div><div class="sidebar-section-title with-arrow" data-isopen="false" id="nYE11oplZw5EksiXPDNlq"><div>Classes</div><svg><use xlink:href="#down-icon"></use></svg></div><div class="sidebar-section-children-container"><div class="sidebar-section-children"><a href="FilePixGenerator.html">FilePixGenerator</a></div><div class="sidebar-section-children"><a href="GradSquarePixGenerator.html">GradSquarePixGenerator</a></div><div class="sidebar-section-children"><a href="MPRPixGenerator.html">MPRPixGenerator</a></div><div class="sidebar-section-children"><a href="dcmb.utils.ListenerHandler.html">ListenerHandler</a></div><div class="sidebar-section-children"><a href="dwv.App.html">App</a></div><div class="sidebar-section-children"><a href="dwv.ModernizrInit-ModernizrProto.html">ModernizrProto</a></div><div class="sidebar-section-children"><a href="dwv.ctrl.DrawController.html">DrawController</a></div><div class="sidebar-section-children"><a href="dwv.ctrl.LoadController.html">LoadController</a></div><div class="sidebar-section-children"><a href="dwv.ctrl.ToolboxController.html">ToolboxController</a></div><div class="sidebar-section-children"><a href="dwv.ctrl.ViewController.html">ViewController</a></div><div class="sidebar-section-children"><a href="dwv.dicom.DataReader.html">DataReader</a></div><div class="sidebar-section-children"><a href="dwv.dicom.DataWriter.html">DataWriter</a></div><div class="sidebar-section-children"><a href="dwv.dicom.DicomElementsWrapper.html">DicomElementsWrapper</a></div><div class="sidebar-section-children"><a href="dwv.dicom.DicomParser.html">DicomParser</a></div><div class="sidebar-section-children"><a href="dwv.dicom.DicomWriter.html">DicomWriter</a></div><div class="sidebar-section-children"><a href="dwv.dicom.Tag.html">Tag</a></div><div class="sidebar-section-children"><a href="dwv.gui.DrawLayer.html">DrawLayer</a></div><div class="sidebar-section-children"><a href="dwv.gui.LayerGroup.html">LayerGroup</a></div><div class="sidebar-section-children"><a href="dwv.gui.Stage.html">Stage</a></div><div class="sidebar-section-children"><a href="dwv.gui.Style.html">Style</a></div><div class="sidebar-section-children"><a href="dwv.gui.ViewLayer.html">ViewLayer</a></div><div class="sidebar-section-children"><a href="dwv.image.AsynchPixelBufferDecoder.html">AsynchPixelBufferDecoder</a></div><div class="sidebar-section-children"><a href="dwv.image.DeleteSegmentCommand.html">DeleteSegmentCommand</a></div><div class="sidebar-section-children"><a href="dwv.image.DicomBufferToView.html">DicomBufferToView</a></div><div class="sidebar-section-children"><a href="dwv.image.Geometry.html">Geometry</a></div><div class="sidebar-section-children"><a href="dwv.image.Image.html">Image</a></div><div class="sidebar-section-children"><a href="dwv.image.ImageFactory.html">ImageFactory</a></div><div class="sidebar-section-children"><a href="dwv.image.MaskFactory.html">MaskFactory</a></div><div class="sidebar-section-children"><a href="dwv.image.MaskSegmentHelper.html">MaskSegmentHelper</a></div><div class="sidebar-section-children"><a href="dwv.image.PixelBufferDecoder.html">PixelBufferDecoder</a></div><div class="sidebar-section-children"><a href="dwv.image.PlaneHelper.html">PlaneHelper</a></div><div class="sidebar-section-children"><a href="dwv.image.RescaleLut.html">RescaleLut</a></div><div class="sidebar-section-children"><a href="dwv.image.RescaleSlopeAndIntercept.html">RescaleSlopeAndIntercept</a></div><div class="sidebar-section-children"><a href="dwv.image.Size.html">Size</a></div><div class="sidebar-section-children"><a href="dwv.image.Spacing.html">Spacing</a></div><div class="sidebar-section-children"><a href="dwv.image.SynchPixelBufferDecoder.html">SynchPixelBufferDecoder</a></div><div class="sidebar-section-children"><a href="dwv.image.View.html">View</a></div><div class="sidebar-section-children"><a href="dwv.image.ViewFactory.html">ViewFactory</a></div><div class="sidebar-section-children"><a href="dwv.image.WindowLevel.html">WindowLevel</a></div><div class="sidebar-section-children"><a href="dwv.image.WindowLut.html">WindowLut</a></div><div class="sidebar-section-children"><a href="dwv.image.filter.Sharpen.html">Sharpen</a></div><div class="sidebar-section-children"><a href="dwv.image.filter.Sobel.html">Sobel</a></div><div class="sidebar-section-children"><a href="dwv.image.filter.Threshold.html">Threshold</a></div><div class="sidebar-section-children"><a href="dwv.io.DicomDataLoader.html">DicomDataLoader</a></div><div class="sidebar-section-children"><a href="dwv.io.FilesLoader.html">FilesLoader</a></div><div class="sidebar-section-children"><a href="dwv.io.JSONTextLoader.html">JSONTextLoader</a></div><div class="sidebar-section-children"><a href="dwv.io.MemoryLoader.html">MemoryLoader</a></div><div class="sidebar-section-children"><a href="dwv.io.MultipartLoader.html">MultipartLoader</a></div><div class="sidebar-section-children"><a href="dwv.io.RawImageLoader.html">RawImageLoader</a></div><div class="sidebar-section-children"><a href="dwv.io.RawVideoLoader.html">RawVideoLoader</a></div><div class="sidebar-section-children"><a href="dwv.io.State.html">State</a></div><div class="sidebar-section-children"><a href="dwv.io.UrlsLoader.html">UrlsLoader</a></div><div class="sidebar-section-children"><a href="dwv.io.ZipLoader.html">ZipLoader</a></div><div class="sidebar-section-children"><a href="dwv.math.BucketQueue.html">BucketQueue</a></div><div class="sidebar-section-children"><a href="dwv.math.Circle.html">Circle</a></div><div class="sidebar-section-children"><a href="dwv.math.Ellipse.html">Ellipse</a></div><div class="sidebar-section-children"><a href="dwv.math.Index.html">Index</a></div><div class="sidebar-section-children"><a href="dwv.math.Line.html">Line</a></div><div class="sidebar-section-children"><a href="dwv.math.Matrix33.html">Matrix33</a></div><div class="sidebar-section-children"><a href="dwv.math.Path.html">Path</a></div><div class="sidebar-section-children"><a href="dwv.math.Point.html">Point</a></div><div class="sidebar-section-children"><a href="dwv.math.Point2D.html">Point2D</a></div><div class="sidebar-section-children"><a href="dwv.math.Point3D.html">Point3D</a></div><div class="sidebar-section-children"><a href="dwv.math.ROI.html">ROI</a></div><div class="sidebar-section-children"><a href="dwv.math.Rectangle.html">Rectangle</a></div><div class="sidebar-section-children"><a href="dwv.math.Scissors.html">Scissors</a></div><div class="sidebar-section-children"><a href="dwv.math.SimpleStats.html">SimpleStats</a></div><div class="sidebar-section-children"><a href="dwv.math.Vector3D.html">Vector3D</a></div><div class="sidebar-section-children"><a href="dwv.tool.ChangeGroupCommand.html">ChangeGroupCommand</a></div><div class="sidebar-section-children"><a href="dwv.tool.DeleteGroupCommand.html">DeleteGroupCommand</a></div><div class="sidebar-section-children"><a href="dwv.tool.Draw.html">Draw</a></div><div class="sidebar-section-children"><a href="dwv.tool.DrawGroupCommand.html">DrawGroupCommand</a></div><div class="sidebar-section-children"><a href="dwv.tool.Filter.html">Filter</a></div><div class="sidebar-section-children"><a href="dwv.tool.Floodfill.html">Floodfill</a></div><div class="sidebar-section-children"><a href="dwv.tool.Livewire.html">Livewire</a></div><div class="sidebar-section-children"><a href="dwv.tool.MoveGroupCommand.html">MoveGroupCommand</a></div><div class="sidebar-section-children"><a href="dwv.tool.Opacity.html">Opacity</a></div><div class="sidebar-section-children"><a href="dwv.tool.RunFilterCommand.html">RunFilterCommand</a></div><div class="sidebar-section-children"><a href="dwv.tool.Scroll.html">Scroll</a></div><div class="sidebar-section-children"><a href="dwv.tool.ScrollWheel.html">ScrollWheel</a></div><div class="sidebar-section-children"><a href="dwv.tool.ShapeEditor.html">ShapeEditor</a></div><div class="sidebar-section-children"><a href="dwv.tool.UndoStack.html">UndoStack</a></div><div class="sidebar-section-children"><a href="dwv.tool.WindowLevel.html">WindowLevel</a></div><div class="sidebar-section-children"><a href="dwv.tool.ZoomAndPan.html">ZoomAndPan</a></div><div class="sidebar-section-children"><a href="dwv.tool.draw.ArrowFactory.html">ArrowFactory</a></div><div class="sidebar-section-children"><a href="dwv.tool.draw.CircleFactory.html">CircleFactory</a></div><div class="sidebar-section-children"><a href="dwv.tool.draw.EllipseFactory.html">EllipseFactory</a></div><div class="sidebar-section-children"><a href="dwv.tool.draw.FreeHandFactory.html">FreeHandFactory</a></div><div class="sidebar-section-children"><a href="dwv.tool.draw.ProtractorFactory.html">ProtractorFactory</a></div><div class="sidebar-section-children"><a href="dwv.tool.draw.RectangleFactory.html">RectangleFactory</a></div><div class="sidebar-section-children"><a href="dwv.tool.draw.RoiFactory.html">RoiFactory</a></div><div class="sidebar-section-children"><a href="dwv.tool.draw.RulerFactory.html">RulerFactory</a></div><div class="sidebar-section-children"><a href="dwv.tool.filter.Sharpen.html">Sharpen</a></div><div class="sidebar-section-children"><a href="dwv.tool.filter.Sobel.html">Sobel</a></div><div class="sidebar-section-children"><a href="dwv.tool.filter.Threshold.html">Threshold</a></div><div class="sidebar-section-children"><a href="dwv.utils.ListenerHandler.html">ListenerHandler</a></div><div class="sidebar-section-children"><a href="dwv.utils.ThreadPool.html">ThreadPool</a></div><div class="sidebar-section-children"><a href="dwv.utils.WorkerTask.html">WorkerTask</a></div><div class="sidebar-section-children"><a href="dwv.utils.WorkerThread.html">WorkerThread</a></div></div><div class="sidebar-section-title with-arrow" data-isopen="false" id="gCSpF9Amf-JCfSNz7Y70c"><div>Externals</div><svg><use xlink:href="#down-icon"></use></svg></div><div class="sidebar-section-children-container"><div class="sidebar-section-children"><a href="external-FileReader.html">FileReader</a></div><div class="sidebar-section-children"><a href="external-JSZip.html">JSZip</a></div><div class="sidebar-section-children"><a href="external-JpegImage.html">JpegImage</a></div><div class="sidebar-section-children"><a href="external-JpxImage.html">JpxImage</a></div><div class="sidebar-section-children"><a href="external-JpxImage.html">JpxImage</a></div><div class="sidebar-section-children"><a href="external-Konva.html">Konva</a></div><div class="sidebar-section-children"><a href="external-Konva.html">Konva</a></div><div class="sidebar-section-children"><a href="external-Konva.html">Konva</a></div><div class="sidebar-section-children"><a href="external-Konva.html">Konva</a></div><div class="sidebar-section-children"><a href="external-Konva.html">Konva</a></div><div class="sidebar-section-children"><a href="external-Konva.html">Konva</a></div><div class="sidebar-section-children"><a href="external-Konva.html">Konva</a></div><div class="sidebar-section-children"><a href="external-Konva.html">Konva</a></div><div class="sidebar-section-children"><a href="external-Konva.html">Konva</a></div><div class="sidebar-section-children"><a href="external-Konva.html">Konva</a></div><div class="sidebar-section-children"><a href="external-Konva.html">Konva</a></div><div class="sidebar-section-children"><a href="external-Konva.html">Konva</a></div><div class="sidebar-section-children"><a href="external-Konva.html">Konva</a></div><div class="sidebar-section-children"><a href="external-MagicWand.html">MagicWand</a></div><div class="sidebar-section-children"><a href="external-TextDecoder.html">TextDecoder</a></div><div class="sidebar-section-children"><a href="external-TextEncoder.html">TextEncoder</a></div><div class="sidebar-section-children"><a href="external-Worker.html">Worker</a></div><div class="sidebar-section-children"><a href="external-XMLHttpRequest.html">XMLHttpRequest</a></div><div class="sidebar-section-children"><a href="external-XMLHttpRequest.html">XMLHttpRequest</a></div><div class="sidebar-section-children"><a href="external-i18next.html">i18next</a></div><div class="sidebar-section-children"><a href="external-i18nextBrowserLanguageDetector.html">i18nextBrowserLanguageDetector</a></div><div class="sidebar-section-children"><a href="external-i18nextHttpBackend.html">i18nextHttpBackend</a></div><div class="sidebar-section-children"><a href="external-jpeg.html">jpeg</a></div></div><div class="sidebar-section-title with-arrow" data-isopen="false" id="dIx1EF6rW_YdnipjQW6PA"><div>Modules</div><svg><use xlink:href="#down-icon"></use></svg></div><div class="sidebar-section-children-container"><div class="sidebar-section-children"><a href="module-tests_dicom.html">tests/dicom</a></div><div class="sidebar-section-children"><a href="module-tests_gui.html">tests/gui</a></div><div class="sidebar-section-children"><a href="module-tests_image.html">tests/image</a></div><div class="sidebar-section-children"><a href="module-tests_io.html">tests/io</a></div><div class="sidebar-section-children"><a href="module-tests_math.html">tests/math</a></div><div class="sidebar-section-children"><a href="module-tests_math.html">tests/math</a></div><div class="sidebar-section-children"><a href="module-tests_state.html">tests/state</a></div><div class="sidebar-section-children"><a href="module-tests_utils.html">tests/utils</a></div><div class="sidebar-section-children"><a href="module-tests_utils.html">tests/utils</a></div></div></div><div class="mobile-navbar-actions"><div class="navbar-right-item"><button class="icon-button search-button" aria-label="open-search"><svg><use xlink:href="#search-icon"></use></svg></button></div><div class="navbar-right-item"><button class="icon-button theme-toggle" aria-label="toggle-theme"><svg><use class="theme-svg-use" xlink:href="#light-theme-icon"></use></svg></button></div><div class="navbar-right-item"><button class="icon-button font-size" aria-label="change-font-size"><svg><use xlink:href="#font-size-icon"></use></svg></button></div></div></div></div><script type="text/javascript" src="scripts/core.min.js"></script><script src="scripts/search.min.js" defer="defer"></script><script src="scripts/third-party/fuse.js" defer="defer"></script><script type="text/javascript">var tocbotInstance=tocbot.init({tocSelector:"#eed4d2a0bfd64539bb9df78095dec881",contentSelector:".main-content",headingSelector:"h1, h2, h3",hasInnerContainers:!0,scrollContainer:".main-content",headingsOffset:130,onClick:bringLinkToView})</script></body></html>