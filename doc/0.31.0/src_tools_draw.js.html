<!DOCTYPE html><html lang="en" style="font-size:16px"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Source: src/tools/draw.js</title><!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]--><script src="scripts/third-party/hljs.js" defer="defer"></script><script src="scripts/third-party/hljs-line-num.js" defer="defer"></script><script src="scripts/third-party/popper.js" defer="defer"></script><script src="scripts/third-party/tippy.js" defer="defer"></script><script src="scripts/third-party/tocbot.min.js"></script><script>var baseURL="/",locationPathname="",baseURL=(locationPathname=document.location.pathname).substr(0,locationPathname.lastIndexOf("/")+1)</script><link rel="stylesheet" href="styles/clean-jsdoc-theme.min.css"><style>ul{list-style-type:disc!important}ul ul{list-style-type:circle!important}</style><svg aria-hidden="true" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" style="display:none"><defs><symbol id="copy-icon" viewbox="0 0 488.3 488.3"><g><path d="M314.25,85.4h-227c-21.3,0-38.6,17.3-38.6,38.6v325.7c0,21.3,17.3,38.6,38.6,38.6h227c21.3,0,38.6-17.3,38.6-38.6V124    C352.75,102.7,335.45,85.4,314.25,85.4z M325.75,449.6c0,6.4-5.2,11.6-11.6,11.6h-227c-6.4,0-11.6-5.2-11.6-11.6V124    c0-6.4,5.2-11.6,11.6-11.6h227c6.4,0,11.6,5.2,11.6,11.6V449.6z"/><path d="M401.05,0h-227c-21.3,0-38.6,17.3-38.6,38.6c0,7.5,6,13.5,13.5,13.5s13.5-6,13.5-13.5c0-6.4,5.2-11.6,11.6-11.6h227    c6.4,0,11.6,5.2,11.6,11.6v325.7c0,6.4-5.2,11.6-11.6,11.6c-7.5,0-13.5,6-13.5,13.5s6,13.5,13.5,13.5c21.3,0,38.6-17.3,38.6-38.6    V38.6C439.65,17.3,422.35,0,401.05,0z"/></g></symbol><symbol id="search-icon" viewBox="0 0 512 512"><g><g><path d="M225.474,0C101.151,0,0,101.151,0,225.474c0,124.33,101.151,225.474,225.474,225.474    c124.33,0,225.474-101.144,225.474-225.474C450.948,101.151,349.804,0,225.474,0z M225.474,409.323    c-101.373,0-183.848-82.475-183.848-183.848S124.101,41.626,225.474,41.626s183.848,82.475,183.848,183.848    S326.847,409.323,225.474,409.323z"/></g></g><g><g><path d="M505.902,476.472L386.574,357.144c-8.131-8.131-21.299-8.131-29.43,0c-8.131,8.124-8.131,21.306,0,29.43l119.328,119.328    c4.065,4.065,9.387,6.098,14.715,6.098c5.321,0,10.649-2.033,14.715-6.098C514.033,497.778,514.033,484.596,505.902,476.472z"/></g></g></symbol><symbol id="font-size-icon" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0z"/><path d="M11.246 15H4.754l-2 5H.6L7 4h2l6.4 16h-2.154l-2-5zm-.8-2L8 6.885 5.554 13h4.892zM21 12.535V12h2v8h-2v-.535a4 4 0 1 1 0-6.93zM19 18a2 2 0 1 0 0-4 2 2 0 0 0 0 4z"/></symbol><symbol id="add-icon" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0z"/><path d="M11 11V5h2v6h6v2h-6v6h-2v-6H5v-2z"/></symbol><symbol id="minus-icon" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0z"/><path d="M5 11h14v2H5z"/></symbol><symbol id="dark-theme-icon" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0z"/><path d="M10 7a7 7 0 0 0 12 4.9v.1c0 5.523-4.477 10-10 10S2 17.523 2 12 6.477 2 12 2h.1A6.979 6.979 0 0 0 10 7zm-6 5a8 8 0 0 0 15.062 3.762A9 9 0 0 1 8.238 4.938 7.999 7.999 0 0 0 4 12z"/></symbol><symbol id="light-theme-icon" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0z"/><path d="M12 18a6 6 0 1 1 0-12 6 6 0 0 1 0 12zm0-2a4 4 0 1 0 0-8 4 4 0 0 0 0 8zM11 1h2v3h-2V1zm0 19h2v3h-2v-3zM3.515 4.929l1.414-1.414L7.05 5.636 5.636 7.05 3.515 4.93zM16.95 18.364l1.414-1.414 2.121 2.121-1.414 1.414-2.121-2.121zm2.121-14.85l1.414 1.415-2.121 2.121-1.414-1.414 2.121-2.121zM5.636 16.95l1.414 1.414-2.121 2.121-1.414-1.414 2.121-2.121zM23 11v2h-3v-2h3zM4 11v2H1v-2h3z"/></symbol><symbol id="reset-icon" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0z"/><path d="M18.537 19.567A9.961 9.961 0 0 1 12 22C6.477 22 2 17.523 2 12S6.477 2 12 2s10 4.477 10 10c0 2.136-.67 4.116-1.81 5.74L17 12h3a8 8 0 1 0-2.46 5.772l.997 1.795z"/></symbol><symbol id="down-icon" viewBox="0 0 16 16"><path fill-rule="evenodd" clip-rule="evenodd" d="M12.7803 6.21967C13.0732 6.51256 13.0732 6.98744 12.7803 7.28033L8.53033 11.5303C8.23744 11.8232 7.76256 11.8232 7.46967 11.5303L3.21967 7.28033C2.92678 6.98744 2.92678 6.51256 3.21967 6.21967C3.51256 5.92678 3.98744 5.92678 4.28033 6.21967L8 9.93934L11.7197 6.21967C12.0126 5.92678 12.4874 5.92678 12.7803 6.21967Z"></path></symbol><symbol id="codepen-icon" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0z"/><path d="M16.5 13.202L13 15.535v3.596L19.197 15 16.5 13.202zM14.697 12L12 10.202 9.303 12 12 13.798 14.697 12zM20 10.869L18.303 12 20 13.131V10.87zM19.197 9L13 4.869v3.596l3.5 2.333L19.197 9zM7.5 10.798L11 8.465V4.869L4.803 9 7.5 10.798zM4.803 15L11 19.131v-3.596l-3.5-2.333L4.803 15zM4 13.131L5.697 12 4 10.869v2.262zM2 9a1 1 0 0 1 .445-.832l9-6a1 1 0 0 1 1.11 0l9 6A1 1 0 0 1 22 9v6a1 1 0 0 1-.445.832l-9 6a1 1 0 0 1-1.11 0l-9-6A1 1 0 0 1 2 15V9z"/></symbol><symbol id="close-icon" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0z"/><path d="M12 10.586l4.95-4.95 1.414 1.414-4.95 4.95 4.95 4.95-1.414 1.414-4.95-4.95-4.95 4.95-1.414-1.414 4.95-4.95-4.95-4.95L7.05 5.636z"/></symbol><symbol id="menu-icon" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0z"/><path d="M3 4h18v2H3V4zm0 7h18v2H3v-2zm0 7h18v2H3v-2z"/></symbol></defs></svg></head><body class="dark" data-theme="dark"><div class="sidebar-container"><div class="sidebar" id="sidebar"><a href="/" class="sidebar-title sidebar-title-anchor">DWV</a><div class="sidebar-items-container"><div class="sidebar-section-title with-arrow" data-isopen="false" id="2H6s5WVDgjYavm09AyrA5"><div>Tutorials</div><svg><use xlink:href="#down-icon"></use></svg></div><div class="sidebar-section-children-container"><div class="sidebar-section-children"><a href="tutorial-architecture.html">architecture</a></div><div class="sidebar-section-children"><a href="tutorial-conformance.html">conformance</a></div><div class="sidebar-section-children"><a href="tutorial-developing.html">developing</a></div><div class="sidebar-section-children"><a href="tutorial-errors.html">errors</a></div><div class="sidebar-section-children"><a href="tutorial-examples.html">examples</a></div><div class="sidebar-section-children"><a href="tutorial-integrations.html">integrations</a></div><div class="sidebar-section-children"><a href="tutorial-module.html">module</a></div><div class="sidebar-section-children"><a href="tutorial-standards.html">standards</a></div><div class="sidebar-section-children"><a href="tutorial-user-stories.html">user-stories</a></div></div><div class="sidebar-section-title with-arrow" data-isopen="false" id="OKNf1TnYMv1IAR-lhf1x-"><div>Namespaces</div><svg><use xlink:href="#down-icon"></use></svg></div><div class="sidebar-section-children-container"><div class="sidebar-section-children"><a href="dwv.html">dwv</a></div><div class="sidebar-section-children"><a href="dwv.ctrl.html">ctrl</a></div><div class="sidebar-section-children"><a href="dwv.dicom.html">dicom</a></div><div class="sidebar-section-children"><a href="dwv.env.html">env</a></div><div class="sidebar-section-children"><a href="dwv.gui.html">gui</a></div><div class="sidebar-section-children"><a href="dwv.image.html">image</a></div><div class="sidebar-section-children"><a href="dwv.image.filter.html">filter</a></div><div class="sidebar-section-children"><a href="dwv.image.lut.html">lut</a></div><div class="sidebar-section-children"><a href="dwv.io.html">io</a></div><div class="sidebar-section-children"><a href="dwv.math.html">math</a></div><div class="sidebar-section-children"><a href="dwv.test.html">test</a></div><div class="sidebar-section-children"><a href="dwv.tool.html">tool</a></div><div class="sidebar-section-children"><a href="dwv.tool.draw_.html">draw</a></div><div class="sidebar-section-children"><a href="dwv.tool.filter_.html">filter</a></div><div class="sidebar-section-children"><a href="dwv.utils.html">utils</a></div><div class="sidebar-section-children"><a href="dwv.utils.logger.html">logger</a></div><div class="sidebar-section-children"><a href="dwv.utils.logger.console.html">console</a></div></div><div class="sidebar-section-title with-arrow" data-isopen="false" id="iMME3X7VrgVN-Ke1KS0sy"><div>Events</div><svg><use xlink:href="#down-icon"></use></svg></div><div class="sidebar-section-children-container"><div class="sidebar-section-children"><a href="dwv.App.html#event:keydown">keydown</a></div><div class="sidebar-section-children"><a href="dwv.App.html#event:load">load</a></div><div class="sidebar-section-children"><a href="dwv.App.html#event:loadabort">loadabort</a></div><div class="sidebar-section-children"><a href="dwv.App.html#event:loadend">loadend</a></div><div class="sidebar-section-children"><a href="dwv.App.html#event:loaderror">loaderror</a></div><div class="sidebar-section-children"><a href="dwv.App.html#event:loaditem">loaditem</a></div><div class="sidebar-section-children"><a href="dwv.App.html#event:loadprogress">loadprogress</a></div><div class="sidebar-section-children"><a href="dwv.App.html#event:loadstart">loadstart</a></div><div class="sidebar-section-children"><a href="dwv.App.html#event:opacitychange">opacitychange</a></div><div class="sidebar-section-children"><a href="dwv.App.html#event:renderend">renderend</a></div><div class="sidebar-section-children"><a href="dwv.App.html#event:renderstart">renderstart</a></div><div class="sidebar-section-children"><a href="dwv.ctrl.LayerGroup.html#event:offsetchange">offsetchange</a></div><div class="sidebar-section-children"><a href="dwv.ctrl.LayerGroup.html#event:zoomchange">zoomchange</a></div><div class="sidebar-section-children"><a href="dwv.image.DeleteSegmentCommand.html#event:masksegmentdelete">masksegmentdelete</a></div><div class="sidebar-section-children"><a href="dwv.image.DeleteSegmentCommand.html#event:masksegmentredraw">masksegmentredraw</a></div><div class="sidebar-section-children"><a href="dwv.image.Image.html#event:imagechange">imagechange</a></div><div class="sidebar-section-children"><a href="dwv.image.View.html#event:alphafuncchange">alphafuncchange</a></div><div class="sidebar-section-children"><a href="dwv.image.View.html#event:colourchange">colourchange</a></div><div class="sidebar-section-children"><a href="dwv.image.View.html#event:positionchange">positionchange</a></div><div class="sidebar-section-children"><a href="dwv.image.View.html#event:wlchange">wlchange</a></div><div class="sidebar-section-children"><a href="dwv.image.View.html#event:wlpresetadd">wlpresetadd</a></div><div class="sidebar-section-children"><a href="dwv.tool.ChangeGroupCommand.html#event:drawchange">drawchange</a></div><div class="sidebar-section-children"><a href="dwv.tool.DeleteGroupCommand.html#event:drawdelete">drawdelete</a></div><div class="sidebar-section-children"><a href="dwv.tool.DrawGroupCommand.html#event:drawcreate">drawcreate</a></div><div class="sidebar-section-children"><a href="dwv.tool.MoveGroupCommand.html#event:drawmove">drawmove</a></div><div class="sidebar-section-children"><a href="dwv.tool.RunFilterCommand.html#event:filterrun">filterrun</a></div><div class="sidebar-section-children"><a href="dwv.tool.RunFilterCommand.html#event:filterundo">filterundo</a></div><div class="sidebar-section-children"><a href="dwv.tool.UndoStack.html#event:redo">redo</a></div><div class="sidebar-section-children"><a href="dwv.tool.UndoStack.html#event:undo">undo</a></div><div class="sidebar-section-children"><a href="dwv.tool.UndoStack.html#event:undoadd">undoadd</a></div></div><div class="sidebar-section-title with-arrow" data-isopen="false" id="BaJKV-hqnx-C5RnMQ30Io"><div>Classes</div><svg><use xlink:href="#down-icon"></use></svg></div><div class="sidebar-section-children-container"><div class="sidebar-section-children"><a href="FilePixGenerator.html">FilePixGenerator</a></div><div class="sidebar-section-children"><a href="GradSquarePixGenerator.html">GradSquarePixGenerator</a></div><div class="sidebar-section-children"><a href="MPRPixGenerator.html">MPRPixGenerator</a></div><div class="sidebar-section-children"><a href="dcmb.utils.ListenerHandler.html">ListenerHandler</a></div><div class="sidebar-section-children"><a href="dwv.App.html">App</a></div><div class="sidebar-section-children"><a href="dwv.ModernizrInit-ModernizrProto.html">ModernizrProto</a></div><div class="sidebar-section-children"><a href="dwv.ctrl.DrawController.html">DrawController</a></div><div class="sidebar-section-children"><a href="dwv.ctrl.LoadController.html">LoadController</a></div><div class="sidebar-section-children"><a href="dwv.ctrl.ToolboxController.html">ToolboxController</a></div><div class="sidebar-section-children"><a href="dwv.ctrl.ViewController.html">ViewController</a></div><div class="sidebar-section-children"><a href="dwv.dicom.DataReader.html">DataReader</a></div><div class="sidebar-section-children"><a href="dwv.dicom.DataWriter.html">DataWriter</a></div><div class="sidebar-section-children"><a href="dwv.dicom.DicomElementsWrapper.html">DicomElementsWrapper</a></div><div class="sidebar-section-children"><a href="dwv.dicom.DicomParser.html">DicomParser</a></div><div class="sidebar-section-children"><a href="dwv.dicom.DicomWriter.html">DicomWriter</a></div><div class="sidebar-section-children"><a href="dwv.dicom.Tag.html">Tag</a></div><div class="sidebar-section-children"><a href="dwv.gui.DrawLayer.html">DrawLayer</a></div><div class="sidebar-section-children"><a href="dwv.gui.LayerGroup.html">LayerGroup</a></div><div class="sidebar-section-children"><a href="dwv.gui.Stage.html">Stage</a></div><div class="sidebar-section-children"><a href="dwv.gui.Style.html">Style</a></div><div class="sidebar-section-children"><a href="dwv.gui.ViewLayer.html">ViewLayer</a></div><div class="sidebar-section-children"><a href="dwv.image.AsynchPixelBufferDecoder.html">AsynchPixelBufferDecoder</a></div><div class="sidebar-section-children"><a href="dwv.image.DeleteSegmentCommand.html">DeleteSegmentCommand</a></div><div class="sidebar-section-children"><a href="dwv.image.DicomBufferToView.html">DicomBufferToView</a></div><div class="sidebar-section-children"><a href="dwv.image.Geometry.html">Geometry</a></div><div class="sidebar-section-children"><a href="dwv.image.Image.html">Image</a></div><div class="sidebar-section-children"><a href="dwv.image.ImageFactory.html">ImageFactory</a></div><div class="sidebar-section-children"><a href="dwv.image.MaskFactory.html">MaskFactory</a></div><div class="sidebar-section-children"><a href="dwv.image.MaskSegmentHelper.html">MaskSegmentHelper</a></div><div class="sidebar-section-children"><a href="dwv.image.PixelBufferDecoder.html">PixelBufferDecoder</a></div><div class="sidebar-section-children"><a href="dwv.image.PlaneHelper.html">PlaneHelper</a></div><div class="sidebar-section-children"><a href="dwv.image.RescaleLut.html">RescaleLut</a></div><div class="sidebar-section-children"><a href="dwv.image.RescaleSlopeAndIntercept.html">RescaleSlopeAndIntercept</a></div><div class="sidebar-section-children"><a href="dwv.image.Size.html">Size</a></div><div class="sidebar-section-children"><a href="dwv.image.Spacing.html">Spacing</a></div><div class="sidebar-section-children"><a href="dwv.image.SynchPixelBufferDecoder.html">SynchPixelBufferDecoder</a></div><div class="sidebar-section-children"><a href="dwv.image.View.html">View</a></div><div class="sidebar-section-children"><a href="dwv.image.ViewFactory.html">ViewFactory</a></div><div class="sidebar-section-children"><a href="dwv.image.WindowLevel.html">WindowLevel</a></div><div class="sidebar-section-children"><a href="dwv.image.WindowLut.html">WindowLut</a></div><div class="sidebar-section-children"><a href="dwv.image.filter.Sharpen.html">Sharpen</a></div><div class="sidebar-section-children"><a href="dwv.image.filter.Sobel.html">Sobel</a></div><div class="sidebar-section-children"><a href="dwv.image.filter.Threshold.html">Threshold</a></div><div class="sidebar-section-children"><a href="dwv.io.DicomDataLoader.html">DicomDataLoader</a></div><div class="sidebar-section-children"><a href="dwv.io.FilesLoader.html">FilesLoader</a></div><div class="sidebar-section-children"><a href="dwv.io.JSONTextLoader.html">JSONTextLoader</a></div><div class="sidebar-section-children"><a href="dwv.io.MemoryLoader.html">MemoryLoader</a></div><div class="sidebar-section-children"><a href="dwv.io.MultipartLoader.html">MultipartLoader</a></div><div class="sidebar-section-children"><a href="dwv.io.RawImageLoader.html">RawImageLoader</a></div><div class="sidebar-section-children"><a href="dwv.io.RawVideoLoader.html">RawVideoLoader</a></div><div class="sidebar-section-children"><a href="dwv.io.State.html">State</a></div><div class="sidebar-section-children"><a href="dwv.io.UrlsLoader.html">UrlsLoader</a></div><div class="sidebar-section-children"><a href="dwv.io.ZipLoader.html">ZipLoader</a></div><div class="sidebar-section-children"><a href="dwv.math.BucketQueue.html">BucketQueue</a></div><div class="sidebar-section-children"><a href="dwv.math.Circle.html">Circle</a></div><div class="sidebar-section-children"><a href="dwv.math.Ellipse.html">Ellipse</a></div><div class="sidebar-section-children"><a href="dwv.math.Index.html">Index</a></div><div class="sidebar-section-children"><a href="dwv.math.Line.html">Line</a></div><div class="sidebar-section-children"><a href="dwv.math.Matrix33.html">Matrix33</a></div><div class="sidebar-section-children"><a href="dwv.math.Path.html">Path</a></div><div class="sidebar-section-children"><a href="dwv.math.Point.html">Point</a></div><div class="sidebar-section-children"><a href="dwv.math.Point2D.html">Point2D</a></div><div class="sidebar-section-children"><a href="dwv.math.Point3D.html">Point3D</a></div><div class="sidebar-section-children"><a href="dwv.math.ROI.html">ROI</a></div><div class="sidebar-section-children"><a href="dwv.math.Rectangle.html">Rectangle</a></div><div class="sidebar-section-children"><a href="dwv.math.Scissors.html">Scissors</a></div><div class="sidebar-section-children"><a href="dwv.math.SimpleStats.html">SimpleStats</a></div><div class="sidebar-section-children"><a href="dwv.math.Vector3D.html">Vector3D</a></div><div class="sidebar-section-children"><a href="dwv.tool.ChangeGroupCommand.html">ChangeGroupCommand</a></div><div class="sidebar-section-children"><a href="dwv.tool.DeleteGroupCommand.html">DeleteGroupCommand</a></div><div class="sidebar-section-children"><a href="dwv.tool.Draw.html">Draw</a></div><div class="sidebar-section-children"><a href="dwv.tool.DrawGroupCommand.html">DrawGroupCommand</a></div><div class="sidebar-section-children"><a href="dwv.tool.Filter.html">Filter</a></div><div class="sidebar-section-children"><a href="dwv.tool.Floodfill.html">Floodfill</a></div><div class="sidebar-section-children"><a href="dwv.tool.Livewire.html">Livewire</a></div><div class="sidebar-section-children"><a href="dwv.tool.MoveGroupCommand.html">MoveGroupCommand</a></div><div class="sidebar-section-children"><a href="dwv.tool.Opacity.html">Opacity</a></div><div class="sidebar-section-children"><a href="dwv.tool.RunFilterCommand.html">RunFilterCommand</a></div><div class="sidebar-section-children"><a href="dwv.tool.Scroll.html">Scroll</a></div><div class="sidebar-section-children"><a href="dwv.tool.ScrollWheel.html">ScrollWheel</a></div><div class="sidebar-section-children"><a href="dwv.tool.ShapeEditor.html">ShapeEditor</a></div><div class="sidebar-section-children"><a href="dwv.tool.UndoStack.html">UndoStack</a></div><div class="sidebar-section-children"><a href="dwv.tool.WindowLevel.html">WindowLevel</a></div><div class="sidebar-section-children"><a href="dwv.tool.ZoomAndPan.html">ZoomAndPan</a></div><div class="sidebar-section-children"><a href="dwv.tool.draw.ArrowFactory.html">ArrowFactory</a></div><div class="sidebar-section-children"><a href="dwv.tool.draw.CircleFactory.html">CircleFactory</a></div><div class="sidebar-section-children"><a href="dwv.tool.draw.EllipseFactory.html">EllipseFactory</a></div><div class="sidebar-section-children"><a href="dwv.tool.draw.FreeHandFactory.html">FreeHandFactory</a></div><div class="sidebar-section-children"><a href="dwv.tool.draw.ProtractorFactory.html">ProtractorFactory</a></div><div class="sidebar-section-children"><a href="dwv.tool.draw.RectangleFactory.html">RectangleFactory</a></div><div class="sidebar-section-children"><a href="dwv.tool.draw.RoiFactory.html">RoiFactory</a></div><div class="sidebar-section-children"><a href="dwv.tool.draw.RulerFactory.html">RulerFactory</a></div><div class="sidebar-section-children"><a href="dwv.tool.filter.Sharpen.html">Sharpen</a></div><div class="sidebar-section-children"><a href="dwv.tool.filter.Sobel.html">Sobel</a></div><div class="sidebar-section-children"><a href="dwv.tool.filter.Threshold.html">Threshold</a></div><div class="sidebar-section-children"><a href="dwv.utils.ListenerHandler.html">ListenerHandler</a></div><div class="sidebar-section-children"><a href="dwv.utils.ThreadPool.html">ThreadPool</a></div><div class="sidebar-section-children"><a href="dwv.utils.WorkerTask.html">WorkerTask</a></div><div class="sidebar-section-children"><a href="dwv.utils.WorkerThread.html">WorkerThread</a></div></div><div class="sidebar-section-title with-arrow" data-isopen="false" id="zn5dGSNAcCChPTcKoW1iw"><div>Externals</div><svg><use xlink:href="#down-icon"></use></svg></div><div class="sidebar-section-children-container"><div class="sidebar-section-children"><a href="external-FileReader.html">FileReader</a></div><div class="sidebar-section-children"><a href="external-JSZip.html">JSZip</a></div><div class="sidebar-section-children"><a href="external-JpegImage.html">JpegImage</a></div><div class="sidebar-section-children"><a href="external-JpxImage.html">JpxImage</a></div><div class="sidebar-section-children"><a href="external-JpxImage.html">JpxImage</a></div><div class="sidebar-section-children"><a href="external-Konva.html">Konva</a></div><div class="sidebar-section-children"><a href="external-Konva.html">Konva</a></div><div class="sidebar-section-children"><a href="external-Konva.html">Konva</a></div><div class="sidebar-section-children"><a href="external-Konva.html">Konva</a></div><div class="sidebar-section-children"><a href="external-Konva.html">Konva</a></div><div class="sidebar-section-children"><a href="external-Konva.html">Konva</a></div><div class="sidebar-section-children"><a href="external-Konva.html">Konva</a></div><div class="sidebar-section-children"><a href="external-Konva.html">Konva</a></div><div class="sidebar-section-children"><a href="external-Konva.html">Konva</a></div><div class="sidebar-section-children"><a href="external-Konva.html">Konva</a></div><div class="sidebar-section-children"><a href="external-Konva.html">Konva</a></div><div class="sidebar-section-children"><a href="external-Konva.html">Konva</a></div><div class="sidebar-section-children"><a href="external-Konva.html">Konva</a></div><div class="sidebar-section-children"><a href="external-MagicWand.html">MagicWand</a></div><div class="sidebar-section-children"><a href="external-TextDecoder.html">TextDecoder</a></div><div class="sidebar-section-children"><a href="external-TextEncoder.html">TextEncoder</a></div><div class="sidebar-section-children"><a href="external-Worker.html">Worker</a></div><div class="sidebar-section-children"><a href="external-XMLHttpRequest.html">XMLHttpRequest</a></div><div class="sidebar-section-children"><a href="external-XMLHttpRequest.html">XMLHttpRequest</a></div><div class="sidebar-section-children"><a href="external-jpeg.html">jpeg</a></div></div><div class="sidebar-section-title with-arrow" data-isopen="false" id="9-lerE0WbyRUZGOHKRsG4"><div>Modules</div><svg><use xlink:href="#down-icon"></use></svg></div><div class="sidebar-section-children-container"><div class="sidebar-section-children"><a href="module-tests_dicom.html">tests/dicom</a></div><div class="sidebar-section-children"><a href="module-tests_gui.html">tests/gui</a></div><div class="sidebar-section-children"><a href="module-tests_image.html">tests/image</a></div><div class="sidebar-section-children"><a href="module-tests_io.html">tests/io</a></div><div class="sidebar-section-children"><a href="module-tests_math.html">tests/math</a></div><div class="sidebar-section-children"><a href="module-tests_math.html">tests/math</a></div><div class="sidebar-section-children"><a href="module-tests_state.html">tests/state</a></div><div class="sidebar-section-children"><a href="module-tests_utils.html">tests/utils</a></div><div class="sidebar-section-children"><a href="module-tests_utils.html">tests/utils</a></div></div></div></div></div><div class="navbar-container" id="VuAckcnZhf"><nav class="navbar"><div class="navbar-left-items"><div class="navbar-item"><a id="" href="https://github.com/ivmartel/dwv" target="_blank">github</a></div><div class="navbar-item"><a id="" href="https://www.npmjs.com/package/dwv" target="_blank">npm</a></div></div><div class="navbar-right-items"><div class="navbar-right-item"><button class="icon-button search-button" aria-label="open-search"><svg><use xlink:href="#search-icon"></use></svg></button></div><div class="navbar-right-item"><button class="icon-button theme-toggle" aria-label="toggle-theme"><svg><use class="theme-svg-use" xlink:href="#light-theme-icon"></use></svg></button></div><div class="navbar-right-item"><button class="icon-button font-size" aria-label="change-font-size"><svg><use xlink:href="#font-size-icon"></use></svg></button></div></div><nav></nav></nav></div><div class="toc-container"><div class="toc-content"><span class="bold">On this page</span><div id="eed4d2a0bfd64539bb9df78095dec881"></div></div></div><div class="body-wrapper"><div class="main-content"><div class="main-wrapper"><section id="source-page" class="source-page"><header><h1 id="title" class="has-anchor">src_tools_draw.js</h1></header><article><pre class="prettyprint source lang-js"><code>// namespaces
var dwv = dwv || {};
dwv.tool = dwv.tool || {};
dwv.tool.draw = dwv.tool.draw || {};
/**
 * The Konva namespace.
 *
 * @external Konva
 * @see https://konvajs.org/
 */
var Konva = Konva || {};

/**
 * Debug flag.
 */
dwv.tool.draw.debug = false;

/**
 * Drawing tool.
 *
 * This tool is responsible for the draw layer group structure. The layout is:
 *
 * drawLayer
 * |_ positionGroup: name="position-group", id="#2-0#_#3-1""
 *    |_ shapeGroup: name="{shape name}-group", id="#"
 *       |_ shape: name="shape"
 *       |_ label: name="label"
 *       |_ extra: line tick, protractor arc...
 *
 * Discussion:
 * - posGroup > shapeGroup
 *    pro: slice/frame display: 1 loop
 *    cons: multi-slice shape splitted in positionGroups
 * - shapeGroup > posGroup
 *    pros: more logical
 *    cons: slice/frame display: 2 loops
 *
 * @class
 * @param {dwv.App} app The associated application.
 */
dwv.tool.Draw = function (app) {
  /**
   * Closure to self: to be used by event handlers.
   *
   * @private
   * @type {dwv.tool.Draw }
   */
  var self = this;
  /**
   * Interaction start flag.
   *
   * @private
   * @type {boolean}
   */
  var started = false;

  /**
   * Shape factory list
   *
   * @type {object}
   */
  this.shapeFactoryList = null;

  /**
   * Current shape factory.
   *
   * @type {object}
   * @private
   */
  var currentFactory = null;

  /**
   * Draw command.
   *
   * @private
   * @type {object}
   */
  var command = null;
  /**
   * Current shape group.
   *
   * @private
   * @type {object}
   */
  var tmpShapeGroup = null;

  /**
   * Shape name.
   *
   * @type {string}
   */
  this.shapeName = 0;

  /**
   * List of points.
   *
   * @private
   * @type {Array}
   */
  var points = [];

  /**
   * Last selected point.
   *
   * @private
   * @type {object}
   */
  var lastPoint = null;

  /**
   * Active shape, ie shape with mouse over.
   *
   * @private
   * @type {object}
   */
  var activeShapeGroup;

  /**
   * Original mouse cursor.
   *
   * @private
   * @type {string}
   */
  var originalCursor;

  /**
   * Mouse cursor.
   *
   * @private
   * @type {string}
   */
  var mouseOverCursor = 'pointer';

  /**
   * Scroll wheel handler.
   *
   * @type {dwv.tool.ScrollWheel}
   */
  var scrollWhell = new dwv.tool.ScrollWheel(app);

  /**
   * Shape editor.
   *
   * @private
   * @type {object}
   */
  var shapeEditor = new dwv.tool.ShapeEditor(app);

  // associate the event listeners of the editor
  //  with those of the draw tool
  shapeEditor.setDrawEventCallback(fireEvent);

  /**
   * Trash draw: a cross.
   *
   * @private
   * @type {object}
   */
  var trash = new Konva.Group();

  // first line of the cross
  var trashLine1 = new Konva.Line({
    points: [-10, -10, 10, 10],
    stroke: 'red'
  });
    // second line of the cross
  var trashLine2 = new Konva.Line({
    points: [10, -10, -10, 10],
    stroke: 'red'
  });
  trash.width(20);
  trash.height(20);
  trash.add(trashLine1);
  trash.add(trashLine2);

  /**
   * Drawing style.
   *
   * @type {dwv.gui.Style}
   */
  this.style = app.getStyle();

  /**
   * Event listeners.
   *
   * @private
   */
  var listeners = {};

  /**
   * Handle mouse down event.
   *
   * @param {object} event The mouse down event.
   */
  this.mousedown = function (event) {
    // exit if a draw was started (handle at mouse move or up)
    if (started) {
      return;
    }

    var layerDetails = dwv.gui.getLayerDetailsFromEvent(event);
    var layerGroup = app.getLayerGroupByDivId(layerDetails.groupDivId);
    var drawLayer = layerGroup.getActiveDrawLayer();

    // determine if the click happened in an existing shape
    var stage = drawLayer.getKonvaStage();
    var kshape = stage.getIntersection({
      x: event._x,
      y: event._y
    });

    // update scale
    self.style.setZoomScale(stage.scale());

    if (kshape) {
      var group = kshape.getParent();
      var selectedShape = group.find('.shape')[0];
      // reset editor if click on other shape
      // (and avoid anchors mouse down)
      if (selectedShape &amp;&amp; selectedShape !== shapeEditor.getShape()) {
        shapeEditor.disable();
        shapeEditor.setShape(selectedShape);
        var viewController =
          layerGroup.getActiveViewLayer().getViewController();
        shapeEditor.setViewController(viewController);
        shapeEditor.enable();
      }
    } else {
      // disable edition
      shapeEditor.disable();
      shapeEditor.setShape(null);
      shapeEditor.setViewController(null);
      // start storing points
      started = true;
      // set factory
      currentFactory = new self.shapeFactoryList[self.shapeName]();
      // clear array
      points = [];
      // store point
      var viewLayer = layerGroup.getActiveViewLayer();
      var pos = viewLayer.displayToPlanePos(event._x, event._y);
      lastPoint = new dwv.math.Point2D(pos.x, pos.y);
      points.push(lastPoint);
    }
  };

  /**
   * Handle mouse move event.
   *
   * @param {object} event The mouse move event.
   */
  this.mousemove = function (event) {
    // exit if not started draw
    if (!started) {
      return;
    }

    var layerDetails = dwv.gui.getLayerDetailsFromEvent(event);
    var layerGroup = app.getLayerGroupByDivId(layerDetails.groupDivId);
    var viewLayer = layerGroup.getActiveViewLayer();
    var pos = viewLayer.displayToPlanePos(event._x, event._y);

    // draw line to current pos
    if (Math.abs(pos.x - lastPoint.getX()) > 0 ||
      Math.abs(pos.y - lastPoint.getY()) > 0) {
      // clear last added point from the list (but not the first one)
      // if it was marked as temporary
      if (points.length !== 1 &amp;&amp;
        typeof points[points.length - 1].tmp !== 'undefined') {
        points.pop();
      }
      // current point
      lastPoint = new dwv.math.Point2D(pos.x, pos.y);
      // mark it as temporary
      lastPoint.tmp = true;
      // add it to the list
      points.push(lastPoint);
      // update points
      onNewPoints(points, layerGroup);
    }
  };

  /**
   * Handle mouse up event.
   *
   * @param {object} event The mouse up event.
   */
  this.mouseup = function (event) {
    // exit if not started draw
    if (!started) {
      return;
    }
    // exit if no points
    if (points.length === 0) {
      dwv.logger.warn('Draw mouseup but no points...');
      return;
    }

    // do we have all the needed points
    if (points.length === currentFactory.getNPoints()) {
      // store points
      var layerDetails = dwv.gui.getLayerDetailsFromEvent(event);
      var layerGroup = app.getLayerGroupByDivId(layerDetails.groupDivId);
      onFinalPoints(points, layerGroup);
      // reset flag
      started = false;
    } else {
      // remove temporary flag
      if (typeof points[points.length - 1].tmp !== 'undefined') {
        delete points[points.length - 1].tmp;
      }
    }
  };

  /**
   * Handle double click event: some tools use it to finish interaction.
   *
   * @param {object} event The double click event.
   */
  this.dblclick = function (event) {
    // only end by double click undefined NPoints
    if (typeof currentFactory.getNPoints() !== 'undefined') {
      return;
    }
    // exit if not started draw
    if (!started) {
      return;
    }
    // exit if no points
    if (points.length === 0) {
      dwv.logger.warn('Draw dblclick but no points...');
      return;
    }

    // store points
    var layerDetails = dwv.gui.getLayerDetailsFromEvent(event);
    var layerGroup = app.getLayerGroupByDivId(layerDetails.groupDivId);
    onFinalPoints(points, layerGroup);
    // reset flag
    started = false;
  };

  /**
   * Handle mouse out event.
   *
   * @param {object} event The mouse out event.
   */
  this.mouseout = function (event) {
    self.mouseup(event);
  };

  /**
   * Handle touch start event.
   *
   * @param {object} event The touch start event.
   */
  this.touchstart = function (event) {
    self.mousedown(event);
  };

  /**
   * Handle touch move event.
   *
   * @param {object} event The touch move event.
   */
  this.touchmove = function (event) {
    // exit if not started draw
    if (!started) {
      return;
    }

    var layerDetails = dwv.gui.getLayerDetailsFromEvent(event);
    var layerGroup = app.getLayerGroupByDivId(layerDetails.groupDivId);
    var viewLayer = layerGroup.getActiveViewLayer();
    var pos = viewLayer.displayToPlanePos(event._x, event._y);

    if (Math.abs(pos.x - lastPoint.getX()) > 0 ||
      Math.abs(pos.y - lastPoint.getY()) > 0) {
      // clear last added point from the list (but not the first one)
      if (points.length !== 1) {
        points.pop();
      }
      // current point
      lastPoint = new dwv.math.Point2D(pos.x, pos.y);
      // add current one to the list
      points.push(lastPoint);
      // allow for anchor points
      if (points.length &lt; currentFactory.getNPoints()) {
        clearTimeout(this.timer);
        this.timer = setTimeout(function () {
          points.push(lastPoint);
        }, currentFactory.getTimeout());
      }
      // update points
      onNewPoints(points, layerGroup);
    }
  };

  /**
   * Handle touch end event.
   *
   * @param {object} event The touch end event.
   */
  this.touchend = function (event) {
    self.dblclick(event);
  };

  /**
   * Handle mouse wheel event.
   *
   * @param {object} event The mouse wheel event.
   */
  this.wheel = function (event) {
    scrollWhell.wheel(event);
  };

  /**
   * Handle key down event.
   *
   * @param {object} event The key down event.
   */
  this.keydown = function (event) {
    // call app handler if we are not in the middle of a draw
    if (!started) {
      event.context = 'dwv.tool.Draw';
      app.onKeydown(event);
    }
    var konvaLayer;

    // press delete or backspace key
    if ((event.key === 'Delete' ||
      event.key === 'Backspace') &amp;&amp;
      shapeEditor.isActive()) {
      // get shape
      var shapeGroup = shapeEditor.getShape().getParent();
      konvaLayer = shapeGroup.getLayer();
      var shapeDisplayName = dwv.tool.GetShapeDisplayName(
        shapeGroup.getChildren(dwv.draw.isNodeNameShape)[0]);
      // delete command
      var delcmd = new dwv.tool.DeleteGroupCommand(shapeGroup,
        shapeDisplayName, konvaLayer);
      delcmd.onExecute = fireEvent;
      delcmd.onUndo = fireEvent;
      delcmd.execute();
      app.addToUndoStack(delcmd);
    }

    // escape key: exit shape creation
    if (event.key === 'Escape' &amp;&amp; tmpShapeGroup !== null) {
      konvaLayer = tmpShapeGroup.getLayer();
      // reset temporary shape group
      tmpShapeGroup.destroy();
      tmpShapeGroup = null;
      // reset flag and points
      started = false;
      points = [];
      // redraw
      konvaLayer.draw();
    }
  };

  /**
   * Update the current draw with new points.
   *
   * @param {Array} tmpPoints The array of new points.
   * @param {dwv.gui.LayerGroup} layerGroup The origin layer group.
   */
  function onNewPoints(tmpPoints, layerGroup) {
    var drawLayer = layerGroup.getActiveDrawLayer();
    var konvaLayer = drawLayer.getKonvaLayer();

    // remove temporary shape draw
    if (tmpShapeGroup) {
      tmpShapeGroup.destroy();
      tmpShapeGroup = null;
    }

    // create shape group
    var viewController =
      layerGroup.getActiveViewLayer().getViewController();
    tmpShapeGroup = currentFactory.create(
      tmpPoints, self.style, viewController);
    // do not listen during creation
    var shape = tmpShapeGroup.getChildren(dwv.draw.isNodeNameShape)[0];
    shape.listening(false);
    konvaLayer.listening(false);
    // draw shape
    konvaLayer.add(tmpShapeGroup);
    konvaLayer.draw();
  }

  /**
   * Create the final shape from a point list.
   *
   * @param {Array} finalPoints The array of points.
   * @param {dwv.gui.LayerGroup} layerGroup The origin layer group.
   */
  function onFinalPoints(finalPoints, layerGroup) {
    var drawLayer = layerGroup.getActiveDrawLayer();
    var konvaLayer = drawLayer.getKonvaLayer();

    // reset temporary shape group
    if (tmpShapeGroup) {
      tmpShapeGroup.destroy();
      tmpShapeGroup = null;
    }

    var viewController =
      layerGroup.getActiveViewLayer().getViewController();
    var drawController =
      layerGroup.getActiveDrawLayer().getDrawController();

    // create final shape
    var finalShapeGroup = currentFactory.create(
      finalPoints, self.style, viewController);
    finalShapeGroup.id(dwv.math.guid());

    // get the position group
    var posGroup = drawController.getCurrentPosGroup();
    // add shape group to position group
    posGroup.add(finalShapeGroup);

    // re-activate layer
    konvaLayer.listening(true);
    // draw shape command
    command = new dwv.tool.DrawGroupCommand(
      finalShapeGroup, self.shapeName, konvaLayer);
    command.onExecute = fireEvent;
    command.onUndo = fireEvent;
    // execute it
    command.execute();
    // save it in undo stack
    app.addToUndoStack(command);

    // activate shape listeners
    self.setShapeOn(finalShapeGroup, layerGroup);
  }

  /**
   * Activate the tool.
   *
   * @param {boolean} flag The flag to activate or not.
   */
  this.activate = function (flag) {
    // reset shape display properties
    shapeEditor.disable();
    shapeEditor.setShape(null);
    shapeEditor.setViewController(null);
    // get the current draw layer
    var layerGroup = app.getActiveLayerGroup();
    activateCurrentPositionShapes(flag, layerGroup);
    // listen to app change to update the draw layer
    if (flag) {
      // store cursor
      originalCursor = document.body.style.cursor;
      // TODO: merge with drawController.activateDrawLayer?
      app.addEventListener('positionchange', function () {
        updateDrawLayer(layerGroup);
      });
      // same for colour
      this.setFeatures({lineColour: this.style.getLineColour()});
    } else {
      // reset shape and cursor
      resetActiveShapeGroup();
      // reset local var
      originalCursor = undefined;
      // remove listeners
      app.removeEventListener('positionchange', function () {
        updateDrawLayer(layerGroup);
      });
    }
  };

  /**
   * Update the draw layer.
   *
   * @param {dwv.gui.LayerGroup} layerGroup The origin layer group.
   */
  function updateDrawLayer(layerGroup) {
    // activate the shape at current position
    activateCurrentPositionShapes(true, layerGroup);
  }

  /**
   * Activate shapes at current position.
   *
   * @param {boolean} visible Set the draw layer visible or not.
   * @param {dwv.gui.LayerGroup} layerGroup The origin layer group.
   */
  function activateCurrentPositionShapes(visible, layerGroup) {
    var drawController =
      layerGroup.getActiveDrawLayer().getDrawController();

    // get shape groups at the current position
    var shapeGroups =
      drawController.getCurrentPosGroup().getChildren();

    // set shape display properties
    if (visible) {
      // activate shape listeners
      shapeGroups.forEach(function (group) {
        self.setShapeOn(group, layerGroup);
      });
    } else {
      // de-activate shape listeners
      shapeGroups.forEach(function (group) {
        setShapeOff(group);
      });
    }
    // draw
    var drawLayer = layerGroup.getActiveDrawLayer();
    var konvaLayer = drawLayer.getKonvaLayer();
    if (shapeGroups.length !== 0) {
      konvaLayer.listening(true);
    }
    konvaLayer.draw();
  }

  /**
   * Set shape group off properties.
   *
   * @param {object} shapeGroup The shape group to set off.
   */
  function setShapeOff(shapeGroup) {
    // mouse styling
    shapeGroup.off('mouseover');
    shapeGroup.off('mouseout');
    // drag
    shapeGroup.draggable(false);
    shapeGroup.off('dragstart.draw');
    shapeGroup.off('dragmove.draw');
    shapeGroup.off('dragend.draw');
    shapeGroup.off('dblclick');
  }

  /**
   * Get the real position from an event.
   * TODO: use layer method?
   *
   * @param {object} index The input index as {x,y}.
   * @param {dwv.gui.LayerGroup} layerGroup The origin layer group.
   * @returns {object} The real position in the image as {x,y}.
   * @private
   */
  function getRealPosition(index, layerGroup) {
    var drawLayer = layerGroup.getActiveDrawLayer();
    var stage = drawLayer.getKonvaStage();
    return {
      x: stage.offset().x + index.x / stage.scale().x,
      y: stage.offset().y + index.y / stage.scale().y
    };
  }

  /**
   * Reset the active shape group and mouse cursor to their original state.
   */
  function resetActiveShapeGroup() {
    if (typeof originalCursor !== 'undefined') {
      document.body.style.cursor = originalCursor;
    }
    if (typeof activeShapeGroup !== 'undefined') {
      activeShapeGroup.opacity(1);
      var colour = self.style.getLineColour();
      activeShapeGroup.getChildren(dwv.draw.canNodeChangeColour).forEach(
        function (ashape) {
          ashape.stroke(colour);
        }
      );
    }
  }

  /**
   * Set shape group on properties.
   *
   * @param {object} shapeGroup The shape group to set on.
   * @param {dwv.gui.LayerGroup} layerGroup The origin layer group.
   */
  this.setShapeOn = function (shapeGroup, layerGroup) {
    // adapt shape and cursor when mouse over
    var mouseOnShape = function () {
      document.body.style.cursor = mouseOverCursor;
      shapeGroup.opacity(0.75);
    };
    // mouse over event hanlding
    shapeGroup.on('mouseover', function () {
      // save local vars
      activeShapeGroup = shapeGroup;
      // adapt shape
      mouseOnShape();
    });
    // mouse out event hanlding
    shapeGroup.on('mouseout', function () {
      // reset shape
      resetActiveShapeGroup();
      // reset local vars
      activeShapeGroup = undefined;
    });

    var drawLayer = layerGroup.getActiveDrawLayer();
    var konvaLayer = drawLayer.getKonvaLayer();

    // make it draggable
    shapeGroup.draggable(true);
    // cache drag start position
    var dragStartPos = {x: shapeGroup.x(), y: shapeGroup.y()};

    // command name based on shape type
    var shapeDisplayName = dwv.tool.GetShapeDisplayName(
      shapeGroup.getChildren(dwv.draw.isNodeNameShape)[0]);

    var colour = null;

    // drag start event handling
    shapeGroup.on('dragstart.draw', function (/*event*/) {
      // store colour
      colour = shapeGroup.getChildren(dwv.draw.isNodeNameShape)[0].stroke();
      // display trash
      var drawLayer = layerGroup.getActiveDrawLayer();
      var stage = drawLayer.getKonvaStage();
      var scale = stage.scale();
      var invscale = {x: 1 / scale.x, y: 1 / scale.y};
      trash.x(stage.offset().x + (stage.width() / (2 * scale.x)));
      trash.y(stage.offset().y + (stage.height() / (15 * scale.y)));
      trash.scale(invscale);
      konvaLayer.add(trash);
      // deactivate anchors to avoid events on null shape
      shapeEditor.setAnchorsActive(false);
      // draw
      konvaLayer.draw();
    });
    // drag move event handling
    shapeGroup.on('dragmove.draw', function (event) {
      var drawLayer = layerGroup.getActiveDrawLayer();
      // validate the group position
      dwv.tool.validateGroupPosition(drawLayer.getBaseSize(), this);
      // get appropriate factory
      var factory;
      var keys = Object.keys(self.shapeFactoryList);
      for (var i = 0; i &lt; keys.length; ++i) {
        factory = new self.shapeFactoryList[keys[i]];
        if (factory.isFactoryGroup(shapeGroup)) {
          // stop at first find
          break;
        }
      }
      if (typeof factory === 'undefined') {
        throw new Error('Cannot find factory to update quantification.');
      }
      // update quantification if possible
      if (typeof factory.updateQuantification !== 'undefined') {
        var vc = layerGroup.getActiveViewLayer().getViewController();
        factory.updateQuantification(this, vc);
      }
      // highlight trash when on it
      var offset = dwv.gui.getEventOffset(event.evt)[0];
      var eventPos = getRealPosition(offset, layerGroup);
      var trashHalfWidth = trash.width() * trash.scaleX() / 2;
      var trashHalfHeight = trash.height() * trash.scaleY() / 2;
      if (Math.abs(eventPos.x - trash.x()) &lt; trashHalfWidth &amp;&amp;
        Math.abs(eventPos.y - trash.y()) &lt; trashHalfHeight) {
        trash.getChildren().forEach(function (tshape) {
          tshape.stroke('orange');
        });
        // change the group shapes colour
        shapeGroup.getChildren(dwv.draw.canNodeChangeColour).forEach(
          function (ashape) {
            ashape.stroke('red');
          });
      } else {
        trash.getChildren().forEach(function (tshape) {
          tshape.stroke('red');
        });
        // reset the group shapes colour
        shapeGroup.getChildren(dwv.draw.canNodeChangeColour).forEach(
          function (ashape) {
            if (typeof ashape.stroke !== 'undefined') {
              ashape.stroke(colour);
            }
          });
      }
      // draw
      konvaLayer.draw();
    });
    // drag end event handling
    shapeGroup.on('dragend.draw', function (event) {
      // remove trash
      trash.remove();
      // activate(false) will also trigger a dragend.draw
      if (typeof event === 'undefined' ||
        typeof event.evt === 'undefined') {
        return;
      }
      var pos = {x: this.x(), y: this.y()};
      // delete case
      var offset = dwv.gui.getEventOffset(event.evt)[0];
      var eventPos = getRealPosition(offset, layerGroup);
      var trashHalfWidth = trash.width() * trash.scaleX() / 2;
      var trashHalfHeight = trash.height() * trash.scaleY() / 2;
      if (Math.abs(eventPos.x - trash.x()) &lt; trashHalfWidth &amp;&amp;
        Math.abs(eventPos.y - trash.y()) &lt; trashHalfHeight) {
        // compensate for the drag translation
        this.x(dragStartPos.x);
        this.y(dragStartPos.y);
        // disable editor
        shapeEditor.disable();
        shapeEditor.setShape(null);
        shapeEditor.setViewController(null);
        // reset colour
        shapeGroup.getChildren(dwv.draw.canNodeChangeColour).forEach(
          function (ashape) {
            ashape.stroke(colour);
          });
        // reset cursor
        document.body.style.cursor = originalCursor;
        // delete command
        var delcmd = new dwv.tool.DeleteGroupCommand(this,
          shapeDisplayName, konvaLayer);
        delcmd.onExecute = fireEvent;
        delcmd.onUndo = fireEvent;
        delcmd.execute();
        app.addToUndoStack(delcmd);
      } else {
        // save drag move
        var translation = {x: pos.x - dragStartPos.x,
          y: pos.y - dragStartPos.y};
        if (translation.x !== 0 || translation.y !== 0) {
          var mvcmd = new dwv.tool.MoveGroupCommand(this,
            shapeDisplayName, translation, konvaLayer);
          mvcmd.onExecute = fireEvent;
          mvcmd.onUndo = fireEvent;
          app.addToUndoStack(mvcmd);

          // the move is handled by Konva, trigger an event manually
          fireEvent({
            type: 'drawmove',
            id: this.id()
          });
        }
        // reset anchors
        shapeEditor.setAnchorsActive(true);
        shapeEditor.resetAnchors();
      }
      // draw
      konvaLayer.draw();
      // reset start position
      dragStartPos = {x: this.x(), y: this.y()};
    });
    // double click handling: update label
    shapeGroup.on('dblclick', function () {
      // get the label object for this shape
      var label = this.findOne('Label');
      // should just be one
      if (typeof label === 'undefined') {
        throw new Error('Could not find the shape label.');
      }
      var ktext = label.getText();
      // id for event
      var groupId = this.id();

      var onSaveCallback = function (meta) {
        // store meta
        ktext.meta = meta;
        // update text expression
        ktext.setText(dwv.utils.replaceFlags(
          ktext.meta.textExpr, ktext.meta.quantification));
        label.setVisible(ktext.meta.textExpr.length !== 0);

        // trigger event
        fireEvent({
          type: 'drawchange',
          id: groupId
        });
        // draw
        konvaLayer.draw();
      };

      // call client dialog if defined
      if (typeof dwv.openRoiDialog !== 'undefined') {
        dwv.openRoiDialog(ktext.meta, onSaveCallback);
      } else {
        // simple prompt for the text expression
        var textExpr = dwv.prompt('Label', ktext.meta.textExpr);
        if (textExpr !== null) {
          ktext.meta.textExpr = textExpr;
          onSaveCallback(ktext.meta);
        }
      }
    });
  };

  /**
   * Set the tool configuration options.
   *
   * @param {object} options The list of shape names amd classes.
   */
  this.setOptions = function (options) {
    // save the options as the shape factory list
    this.shapeFactoryList = options;
    // pass them to the editor
    shapeEditor.setFactoryList(options);
  };

  /**
   * Get the type of tool options: here 'factory' since the shape
   * list contains factories to create each possible shape.
   *
   * @returns {string} The type.
   */
  this.getOptionsType = function () {
    return 'factory';
  };

  /**
   * Set the tool live features: shape colour and shape name.
   *
   * @param {object} features The list of features.
   */
  this.setFeatures = function (features) {
    if (typeof features.shapeColour !== 'undefined') {
      this.style.setLineColour(features.shapeColour);
    }
    if (typeof features.shapeName !== 'undefined') {
      // check if we have it
      if (!this.hasShape(features.shapeName)) {
        throw new Error('Unknown shape: \'' + features.shapeName + '\'');
      }
      this.shapeName = features.shapeName;
    }
    if (typeof features.mouseOverCursor !== 'undefined') {
      mouseOverCursor = features.mouseOverCursor;
    }
  };

  /**
   * Initialise the tool.
   */
  this.init = function () {
    // does nothing
  };

  /**
   * Get the list of event names that this tool can fire.
   *
   * @returns {Array} The list of event names.
   */
  this.getEventNames = function () {
    return [
      'drawcreate', 'drawchange', 'drawmove', 'drawdelete', 'drawlabelchange'
    ];
  };

  /**
   * Add an event listener on the app.
   *
   * @param {string} type The event type.
   * @param {object} listener The method associated with the provided
   *   event type.
   */
  this.addEventListener = function (type, listener) {
    if (typeof listeners[type] === 'undefined') {
      listeners[type] = [];
    }
    listeners[type].push(listener);
  };

  /**
   * Remove an event listener from the app.
   *
   * @param {string} type The event type.
   * @param {object} listener The method associated with the provided
   *   event type.
   */
  this.removeEventListener = function (type, listener) {
    if (typeof listeners[type] === 'undefined') {
      return;
    }
    for (var i = 0; i &lt; listeners[type].length; ++i) {
      if (listeners[type][i] === listener) {
        listeners[type].splice(i, 1);
      }
    }
  };

  // Private Methods -----------------------------------------------------------

  /**
   * Fire an event: call all associated listeners.
   *
   * @param {object} event The event to fire.
   * @private
   */
  function fireEvent(event) {
    if (typeof listeners[event.type] === 'undefined') {
      return;
    }
    for (var i = 0; i &lt; listeners[event.type].length; ++i) {
      listeners[event.type][i](event);
    }
  }

}; // Draw class

/**
 * Check if the shape is in the shape list.
 *
 * @param {string} name The name of the shape.
 * @returns {boolean} True if there is a factory for the shape.
 */
dwv.tool.Draw.prototype.hasShape = function (name) {
  return this.shapeFactoryList[name];
};

/**
 * Get the minimum position in a groups' anchors.
 *
 * @param {object} group The group that contains anchors.
 * @returns {object|undefined} The minimum position as {x,y}.
 */
dwv.tool.getAnchorMin = function (group) {
  var anchors = group.find('.anchor');
  if (anchors.length === 0) {
    return undefined;
  }
  var minX = anchors[0].x();
  var minY = anchors[0].y();
  for (var i = 0; i &lt; anchors.length; ++i) {
    minX = Math.min(minX, anchors[i].x());
    minY = Math.min(minY, anchors[i].y());
  }

  return {x: minX, y: minY};
};

/**
 * Bound a node position.
 *
 * @param {object} node The node to bound the position.
 * @param {object} min The minimum position as {x,y}.
 * @param {object} max The maximum position as {x,y}.
 * @returns {boolean} True if the position was corrected.
 */
dwv.tool.boundNodePosition = function (node, min, max) {
  var changed = false;
  if (node.x() &lt; min.x) {
    node.x(min.x);
    changed = true;
  } else if (node.x() > max.x) {
    node.x(max.x);
    changed = true;
  }
  if (node.y() &lt; min.y) {
    node.y(min.y);
    changed = true;
  } else if (node.y() > max.y) {
    node.y(max.y);
    changed = true;
  }
  return changed;
};

/**
 * Validate a group position.
 *
 * @param {object} stageSize The stage size {x,y}.
 * @param {object} group The group to evaluate.
 * @returns {boolean} True if the position was corrected.
 */
dwv.tool.validateGroupPosition = function (stageSize, group) {
  // if anchors get mixed, width/height can be negative
  var shape = group.getChildren(dwv.draw.isNodeNameShape)[0];
  var anchorMin = dwv.tool.getAnchorMin(group);
  // handle no anchor: when dragging the label, the editor does
  //   not activate
  if (typeof anchorMin === 'undefined') {
    return null;
  }

  var min = {
    x: -anchorMin.x,
    y: -anchorMin.y
  };
  var max = {
    x: stageSize.x -
      (anchorMin.x + Math.abs(shape.width())),
    y: stageSize.y -
      (anchorMin.y + Math.abs(shape.height()))
  };

  return dwv.tool.boundNodePosition(group, min, max);
};

/**
 * Validate an anchor position.
 *
 * @param {object} stageSize The stage size {x,y}.
 * @param {object} anchor The anchor to evaluate.
 * @returns {boolean} True if the position was corrected.
 */
dwv.tool.validateAnchorPosition = function (stageSize, anchor) {
  var group = anchor.getParent();

  var min = {
    x: -group.x(),
    y: -group.y()
  };
  var max = {
    x: stageSize.x - group.x(),
    y: stageSize.y - group.y()
  };

  return dwv.tool.boundNodePosition(anchor, min, max);
};
</code></pre></article></section><footer class="footer" id="PeOAagUepe"><div class="wrapper"><i>Documentation generated for dwv v0.31.0.</i></div></footer></div></div></div><div class="search-container" id="PkfLWpAbet" style="display:none"><div class="wrapper" id="iCxFxjkHbP"><button class="icon-button search-close-button" id="VjLlGakifb" aria-label="close search"><svg><use xlink:href="#close-icon"></use></svg></button><div class="search-box-c"><svg><use xlink:href="#search-icon"></use></svg> <input type="text" id="vpcKVYIppa" class="search-input" placeholder="Search..." autofocus></div><div class="search-result-c" id="fWwVHRuDuN"><span class="search-result-c-text">Type anything to view search result</span></div></div></div><div class="mobile-menu-icon-container"><button class="icon-button" id="mobile-menu" data-isopen="false" aria-label="menu"><svg><use xlink:href="#menu-icon"></use></svg></button></div><div id="mobile-sidebar" class="mobile-sidebar-container"><div class="mobile-sidebar-wrapper"><a href="/" class="sidebar-title sidebar-title-anchor">DWV</a><div class="mobile-nav-links"><div class="navbar-item"><a id="" href="https://github.com/ivmartel/dwv" target="_blank">github</a></div><div class="navbar-item"><a id="" href="https://www.npmjs.com/package/dwv" target="_blank">npm</a></div></div><div class="mobile-sidebar-items-c"><div class="sidebar-section-title with-arrow" data-isopen="false" id="2H6s5WVDgjYavm09AyrA5"><div>Tutorials</div><svg><use xlink:href="#down-icon"></use></svg></div><div class="sidebar-section-children-container"><div class="sidebar-section-children"><a href="tutorial-architecture.html">architecture</a></div><div class="sidebar-section-children"><a href="tutorial-conformance.html">conformance</a></div><div class="sidebar-section-children"><a href="tutorial-developing.html">developing</a></div><div class="sidebar-section-children"><a href="tutorial-errors.html">errors</a></div><div class="sidebar-section-children"><a href="tutorial-examples.html">examples</a></div><div class="sidebar-section-children"><a href="tutorial-integrations.html">integrations</a></div><div class="sidebar-section-children"><a href="tutorial-module.html">module</a></div><div class="sidebar-section-children"><a href="tutorial-standards.html">standards</a></div><div class="sidebar-section-children"><a href="tutorial-user-stories.html">user-stories</a></div></div><div class="sidebar-section-title with-arrow" data-isopen="false" id="OKNf1TnYMv1IAR-lhf1x-"><div>Namespaces</div><svg><use xlink:href="#down-icon"></use></svg></div><div class="sidebar-section-children-container"><div class="sidebar-section-children"><a href="dwv.html">dwv</a></div><div class="sidebar-section-children"><a href="dwv.ctrl.html">ctrl</a></div><div class="sidebar-section-children"><a href="dwv.dicom.html">dicom</a></div><div class="sidebar-section-children"><a href="dwv.env.html">env</a></div><div class="sidebar-section-children"><a href="dwv.gui.html">gui</a></div><div class="sidebar-section-children"><a href="dwv.image.html">image</a></div><div class="sidebar-section-children"><a href="dwv.image.filter.html">filter</a></div><div class="sidebar-section-children"><a href="dwv.image.lut.html">lut</a></div><div class="sidebar-section-children"><a href="dwv.io.html">io</a></div><div class="sidebar-section-children"><a href="dwv.math.html">math</a></div><div class="sidebar-section-children"><a href="dwv.test.html">test</a></div><div class="sidebar-section-children"><a href="dwv.tool.html">tool</a></div><div class="sidebar-section-children"><a href="dwv.tool.draw_.html">draw</a></div><div class="sidebar-section-children"><a href="dwv.tool.filter_.html">filter</a></div><div class="sidebar-section-children"><a href="dwv.utils.html">utils</a></div><div class="sidebar-section-children"><a href="dwv.utils.logger.html">logger</a></div><div class="sidebar-section-children"><a href="dwv.utils.logger.console.html">console</a></div></div><div class="sidebar-section-title with-arrow" data-isopen="false" id="iMME3X7VrgVN-Ke1KS0sy"><div>Events</div><svg><use xlink:href="#down-icon"></use></svg></div><div class="sidebar-section-children-container"><div class="sidebar-section-children"><a href="dwv.App.html#event:keydown">keydown</a></div><div class="sidebar-section-children"><a href="dwv.App.html#event:load">load</a></div><div class="sidebar-section-children"><a href="dwv.App.html#event:loadabort">loadabort</a></div><div class="sidebar-section-children"><a href="dwv.App.html#event:loadend">loadend</a></div><div class="sidebar-section-children"><a href="dwv.App.html#event:loaderror">loaderror</a></div><div class="sidebar-section-children"><a href="dwv.App.html#event:loaditem">loaditem</a></div><div class="sidebar-section-children"><a href="dwv.App.html#event:loadprogress">loadprogress</a></div><div class="sidebar-section-children"><a href="dwv.App.html#event:loadstart">loadstart</a></div><div class="sidebar-section-children"><a href="dwv.App.html#event:opacitychange">opacitychange</a></div><div class="sidebar-section-children"><a href="dwv.App.html#event:renderend">renderend</a></div><div class="sidebar-section-children"><a href="dwv.App.html#event:renderstart">renderstart</a></div><div class="sidebar-section-children"><a href="dwv.ctrl.LayerGroup.html#event:offsetchange">offsetchange</a></div><div class="sidebar-section-children"><a href="dwv.ctrl.LayerGroup.html#event:zoomchange">zoomchange</a></div><div class="sidebar-section-children"><a href="dwv.image.DeleteSegmentCommand.html#event:masksegmentdelete">masksegmentdelete</a></div><div class="sidebar-section-children"><a href="dwv.image.DeleteSegmentCommand.html#event:masksegmentredraw">masksegmentredraw</a></div><div class="sidebar-section-children"><a href="dwv.image.Image.html#event:imagechange">imagechange</a></div><div class="sidebar-section-children"><a href="dwv.image.View.html#event:alphafuncchange">alphafuncchange</a></div><div class="sidebar-section-children"><a href="dwv.image.View.html#event:colourchange">colourchange</a></div><div class="sidebar-section-children"><a href="dwv.image.View.html#event:positionchange">positionchange</a></div><div class="sidebar-section-children"><a href="dwv.image.View.html#event:wlchange">wlchange</a></div><div class="sidebar-section-children"><a href="dwv.image.View.html#event:wlpresetadd">wlpresetadd</a></div><div class="sidebar-section-children"><a href="dwv.tool.ChangeGroupCommand.html#event:drawchange">drawchange</a></div><div class="sidebar-section-children"><a href="dwv.tool.DeleteGroupCommand.html#event:drawdelete">drawdelete</a></div><div class="sidebar-section-children"><a href="dwv.tool.DrawGroupCommand.html#event:drawcreate">drawcreate</a></div><div class="sidebar-section-children"><a href="dwv.tool.MoveGroupCommand.html#event:drawmove">drawmove</a></div><div class="sidebar-section-children"><a href="dwv.tool.RunFilterCommand.html#event:filterrun">filterrun</a></div><div class="sidebar-section-children"><a href="dwv.tool.RunFilterCommand.html#event:filterundo">filterundo</a></div><div class="sidebar-section-children"><a href="dwv.tool.UndoStack.html#event:redo">redo</a></div><div class="sidebar-section-children"><a href="dwv.tool.UndoStack.html#event:undo">undo</a></div><div class="sidebar-section-children"><a href="dwv.tool.UndoStack.html#event:undoadd">undoadd</a></div></div><div class="sidebar-section-title with-arrow" data-isopen="false" id="BaJKV-hqnx-C5RnMQ30Io"><div>Classes</div><svg><use xlink:href="#down-icon"></use></svg></div><div class="sidebar-section-children-container"><div class="sidebar-section-children"><a href="FilePixGenerator.html">FilePixGenerator</a></div><div class="sidebar-section-children"><a href="GradSquarePixGenerator.html">GradSquarePixGenerator</a></div><div class="sidebar-section-children"><a href="MPRPixGenerator.html">MPRPixGenerator</a></div><div class="sidebar-section-children"><a href="dcmb.utils.ListenerHandler.html">ListenerHandler</a></div><div class="sidebar-section-children"><a href="dwv.App.html">App</a></div><div class="sidebar-section-children"><a href="dwv.ModernizrInit-ModernizrProto.html">ModernizrProto</a></div><div class="sidebar-section-children"><a href="dwv.ctrl.DrawController.html">DrawController</a></div><div class="sidebar-section-children"><a href="dwv.ctrl.LoadController.html">LoadController</a></div><div class="sidebar-section-children"><a href="dwv.ctrl.ToolboxController.html">ToolboxController</a></div><div class="sidebar-section-children"><a href="dwv.ctrl.ViewController.html">ViewController</a></div><div class="sidebar-section-children"><a href="dwv.dicom.DataReader.html">DataReader</a></div><div class="sidebar-section-children"><a href="dwv.dicom.DataWriter.html">DataWriter</a></div><div class="sidebar-section-children"><a href="dwv.dicom.DicomElementsWrapper.html">DicomElementsWrapper</a></div><div class="sidebar-section-children"><a href="dwv.dicom.DicomParser.html">DicomParser</a></div><div class="sidebar-section-children"><a href="dwv.dicom.DicomWriter.html">DicomWriter</a></div><div class="sidebar-section-children"><a href="dwv.dicom.Tag.html">Tag</a></div><div class="sidebar-section-children"><a href="dwv.gui.DrawLayer.html">DrawLayer</a></div><div class="sidebar-section-children"><a href="dwv.gui.LayerGroup.html">LayerGroup</a></div><div class="sidebar-section-children"><a href="dwv.gui.Stage.html">Stage</a></div><div class="sidebar-section-children"><a href="dwv.gui.Style.html">Style</a></div><div class="sidebar-section-children"><a href="dwv.gui.ViewLayer.html">ViewLayer</a></div><div class="sidebar-section-children"><a href="dwv.image.AsynchPixelBufferDecoder.html">AsynchPixelBufferDecoder</a></div><div class="sidebar-section-children"><a href="dwv.image.DeleteSegmentCommand.html">DeleteSegmentCommand</a></div><div class="sidebar-section-children"><a href="dwv.image.DicomBufferToView.html">DicomBufferToView</a></div><div class="sidebar-section-children"><a href="dwv.image.Geometry.html">Geometry</a></div><div class="sidebar-section-children"><a href="dwv.image.Image.html">Image</a></div><div class="sidebar-section-children"><a href="dwv.image.ImageFactory.html">ImageFactory</a></div><div class="sidebar-section-children"><a href="dwv.image.MaskFactory.html">MaskFactory</a></div><div class="sidebar-section-children"><a href="dwv.image.MaskSegmentHelper.html">MaskSegmentHelper</a></div><div class="sidebar-section-children"><a href="dwv.image.PixelBufferDecoder.html">PixelBufferDecoder</a></div><div class="sidebar-section-children"><a href="dwv.image.PlaneHelper.html">PlaneHelper</a></div><div class="sidebar-section-children"><a href="dwv.image.RescaleLut.html">RescaleLut</a></div><div class="sidebar-section-children"><a href="dwv.image.RescaleSlopeAndIntercept.html">RescaleSlopeAndIntercept</a></div><div class="sidebar-section-children"><a href="dwv.image.Size.html">Size</a></div><div class="sidebar-section-children"><a href="dwv.image.Spacing.html">Spacing</a></div><div class="sidebar-section-children"><a href="dwv.image.SynchPixelBufferDecoder.html">SynchPixelBufferDecoder</a></div><div class="sidebar-section-children"><a href="dwv.image.View.html">View</a></div><div class="sidebar-section-children"><a href="dwv.image.ViewFactory.html">ViewFactory</a></div><div class="sidebar-section-children"><a href="dwv.image.WindowLevel.html">WindowLevel</a></div><div class="sidebar-section-children"><a href="dwv.image.WindowLut.html">WindowLut</a></div><div class="sidebar-section-children"><a href="dwv.image.filter.Sharpen.html">Sharpen</a></div><div class="sidebar-section-children"><a href="dwv.image.filter.Sobel.html">Sobel</a></div><div class="sidebar-section-children"><a href="dwv.image.filter.Threshold.html">Threshold</a></div><div class="sidebar-section-children"><a href="dwv.io.DicomDataLoader.html">DicomDataLoader</a></div><div class="sidebar-section-children"><a href="dwv.io.FilesLoader.html">FilesLoader</a></div><div class="sidebar-section-children"><a href="dwv.io.JSONTextLoader.html">JSONTextLoader</a></div><div class="sidebar-section-children"><a href="dwv.io.MemoryLoader.html">MemoryLoader</a></div><div class="sidebar-section-children"><a href="dwv.io.MultipartLoader.html">MultipartLoader</a></div><div class="sidebar-section-children"><a href="dwv.io.RawImageLoader.html">RawImageLoader</a></div><div class="sidebar-section-children"><a href="dwv.io.RawVideoLoader.html">RawVideoLoader</a></div><div class="sidebar-section-children"><a href="dwv.io.State.html">State</a></div><div class="sidebar-section-children"><a href="dwv.io.UrlsLoader.html">UrlsLoader</a></div><div class="sidebar-section-children"><a href="dwv.io.ZipLoader.html">ZipLoader</a></div><div class="sidebar-section-children"><a href="dwv.math.BucketQueue.html">BucketQueue</a></div><div class="sidebar-section-children"><a href="dwv.math.Circle.html">Circle</a></div><div class="sidebar-section-children"><a href="dwv.math.Ellipse.html">Ellipse</a></div><div class="sidebar-section-children"><a href="dwv.math.Index.html">Index</a></div><div class="sidebar-section-children"><a href="dwv.math.Line.html">Line</a></div><div class="sidebar-section-children"><a href="dwv.math.Matrix33.html">Matrix33</a></div><div class="sidebar-section-children"><a href="dwv.math.Path.html">Path</a></div><div class="sidebar-section-children"><a href="dwv.math.Point.html">Point</a></div><div class="sidebar-section-children"><a href="dwv.math.Point2D.html">Point2D</a></div><div class="sidebar-section-children"><a href="dwv.math.Point3D.html">Point3D</a></div><div class="sidebar-section-children"><a href="dwv.math.ROI.html">ROI</a></div><div class="sidebar-section-children"><a href="dwv.math.Rectangle.html">Rectangle</a></div><div class="sidebar-section-children"><a href="dwv.math.Scissors.html">Scissors</a></div><div class="sidebar-section-children"><a href="dwv.math.SimpleStats.html">SimpleStats</a></div><div class="sidebar-section-children"><a href="dwv.math.Vector3D.html">Vector3D</a></div><div class="sidebar-section-children"><a href="dwv.tool.ChangeGroupCommand.html">ChangeGroupCommand</a></div><div class="sidebar-section-children"><a href="dwv.tool.DeleteGroupCommand.html">DeleteGroupCommand</a></div><div class="sidebar-section-children"><a href="dwv.tool.Draw.html">Draw</a></div><div class="sidebar-section-children"><a href="dwv.tool.DrawGroupCommand.html">DrawGroupCommand</a></div><div class="sidebar-section-children"><a href="dwv.tool.Filter.html">Filter</a></div><div class="sidebar-section-children"><a href="dwv.tool.Floodfill.html">Floodfill</a></div><div class="sidebar-section-children"><a href="dwv.tool.Livewire.html">Livewire</a></div><div class="sidebar-section-children"><a href="dwv.tool.MoveGroupCommand.html">MoveGroupCommand</a></div><div class="sidebar-section-children"><a href="dwv.tool.Opacity.html">Opacity</a></div><div class="sidebar-section-children"><a href="dwv.tool.RunFilterCommand.html">RunFilterCommand</a></div><div class="sidebar-section-children"><a href="dwv.tool.Scroll.html">Scroll</a></div><div class="sidebar-section-children"><a href="dwv.tool.ScrollWheel.html">ScrollWheel</a></div><div class="sidebar-section-children"><a href="dwv.tool.ShapeEditor.html">ShapeEditor</a></div><div class="sidebar-section-children"><a href="dwv.tool.UndoStack.html">UndoStack</a></div><div class="sidebar-section-children"><a href="dwv.tool.WindowLevel.html">WindowLevel</a></div><div class="sidebar-section-children"><a href="dwv.tool.ZoomAndPan.html">ZoomAndPan</a></div><div class="sidebar-section-children"><a href="dwv.tool.draw.ArrowFactory.html">ArrowFactory</a></div><div class="sidebar-section-children"><a href="dwv.tool.draw.CircleFactory.html">CircleFactory</a></div><div class="sidebar-section-children"><a href="dwv.tool.draw.EllipseFactory.html">EllipseFactory</a></div><div class="sidebar-section-children"><a href="dwv.tool.draw.FreeHandFactory.html">FreeHandFactory</a></div><div class="sidebar-section-children"><a href="dwv.tool.draw.ProtractorFactory.html">ProtractorFactory</a></div><div class="sidebar-section-children"><a href="dwv.tool.draw.RectangleFactory.html">RectangleFactory</a></div><div class="sidebar-section-children"><a href="dwv.tool.draw.RoiFactory.html">RoiFactory</a></div><div class="sidebar-section-children"><a href="dwv.tool.draw.RulerFactory.html">RulerFactory</a></div><div class="sidebar-section-children"><a href="dwv.tool.filter.Sharpen.html">Sharpen</a></div><div class="sidebar-section-children"><a href="dwv.tool.filter.Sobel.html">Sobel</a></div><div class="sidebar-section-children"><a href="dwv.tool.filter.Threshold.html">Threshold</a></div><div class="sidebar-section-children"><a href="dwv.utils.ListenerHandler.html">ListenerHandler</a></div><div class="sidebar-section-children"><a href="dwv.utils.ThreadPool.html">ThreadPool</a></div><div class="sidebar-section-children"><a href="dwv.utils.WorkerTask.html">WorkerTask</a></div><div class="sidebar-section-children"><a href="dwv.utils.WorkerThread.html">WorkerThread</a></div></div><div class="sidebar-section-title with-arrow" data-isopen="false" id="zn5dGSNAcCChPTcKoW1iw"><div>Externals</div><svg><use xlink:href="#down-icon"></use></svg></div><div class="sidebar-section-children-container"><div class="sidebar-section-children"><a href="external-FileReader.html">FileReader</a></div><div class="sidebar-section-children"><a href="external-JSZip.html">JSZip</a></div><div class="sidebar-section-children"><a href="external-JpegImage.html">JpegImage</a></div><div class="sidebar-section-children"><a href="external-JpxImage.html">JpxImage</a></div><div class="sidebar-section-children"><a href="external-JpxImage.html">JpxImage</a></div><div class="sidebar-section-children"><a href="external-Konva.html">Konva</a></div><div class="sidebar-section-children"><a href="external-Konva.html">Konva</a></div><div class="sidebar-section-children"><a href="external-Konva.html">Konva</a></div><div class="sidebar-section-children"><a href="external-Konva.html">Konva</a></div><div class="sidebar-section-children"><a href="external-Konva.html">Konva</a></div><div class="sidebar-section-children"><a href="external-Konva.html">Konva</a></div><div class="sidebar-section-children"><a href="external-Konva.html">Konva</a></div><div class="sidebar-section-children"><a href="external-Konva.html">Konva</a></div><div class="sidebar-section-children"><a href="external-Konva.html">Konva</a></div><div class="sidebar-section-children"><a href="external-Konva.html">Konva</a></div><div class="sidebar-section-children"><a href="external-Konva.html">Konva</a></div><div class="sidebar-section-children"><a href="external-Konva.html">Konva</a></div><div class="sidebar-section-children"><a href="external-Konva.html">Konva</a></div><div class="sidebar-section-children"><a href="external-MagicWand.html">MagicWand</a></div><div class="sidebar-section-children"><a href="external-TextDecoder.html">TextDecoder</a></div><div class="sidebar-section-children"><a href="external-TextEncoder.html">TextEncoder</a></div><div class="sidebar-section-children"><a href="external-Worker.html">Worker</a></div><div class="sidebar-section-children"><a href="external-XMLHttpRequest.html">XMLHttpRequest</a></div><div class="sidebar-section-children"><a href="external-XMLHttpRequest.html">XMLHttpRequest</a></div><div class="sidebar-section-children"><a href="external-jpeg.html">jpeg</a></div></div><div class="sidebar-section-title with-arrow" data-isopen="false" id="9-lerE0WbyRUZGOHKRsG4"><div>Modules</div><svg><use xlink:href="#down-icon"></use></svg></div><div class="sidebar-section-children-container"><div class="sidebar-section-children"><a href="module-tests_dicom.html">tests/dicom</a></div><div class="sidebar-section-children"><a href="module-tests_gui.html">tests/gui</a></div><div class="sidebar-section-children"><a href="module-tests_image.html">tests/image</a></div><div class="sidebar-section-children"><a href="module-tests_io.html">tests/io</a></div><div class="sidebar-section-children"><a href="module-tests_math.html">tests/math</a></div><div class="sidebar-section-children"><a href="module-tests_math.html">tests/math</a></div><div class="sidebar-section-children"><a href="module-tests_state.html">tests/state</a></div><div class="sidebar-section-children"><a href="module-tests_utils.html">tests/utils</a></div><div class="sidebar-section-children"><a href="module-tests_utils.html">tests/utils</a></div></div></div><div class="mobile-navbar-actions"><div class="navbar-right-item"><button class="icon-button search-button" aria-label="open-search"><svg><use xlink:href="#search-icon"></use></svg></button></div><div class="navbar-right-item"><button class="icon-button theme-toggle" aria-label="toggle-theme"><svg><use class="theme-svg-use" xlink:href="#light-theme-icon"></use></svg></button></div><div class="navbar-right-item"><button class="icon-button font-size" aria-label="change-font-size"><svg><use xlink:href="#font-size-icon"></use></svg></button></div></div></div></div><script type="text/javascript" src="scripts/core.min.js"></script><script src="scripts/search.min.js" defer="defer"></script><script src="scripts/third-party/fuse.js" defer="defer"></script><script type="text/javascript">var tocbotInstance=tocbot.init({tocSelector:"#eed4d2a0bfd64539bb9df78095dec881",contentSelector:".main-content",headingSelector:"h1, h2, h3",hasInnerContainers:!0,scrollContainer:".main-content",headingsOffset:130,onClick:bringLinkToView})</script></body></html>